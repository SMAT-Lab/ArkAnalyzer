"use strict";var M=require("path"),Oe=require("fs"),mn=require("tty"),je=require("util"),ve=require("os"),mo=require("url"),ho=require("constants"),hn=require("stream"),yn=require("assert"),yo=require("zlib"),go=require("net");function gn(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var te=gn(M),xe=gn(Oe),Nt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bt={exports:{}},tt={exports:{}},Mt,vn;function vo(){if(vn)return Mt;vn=1;var e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,o=r*365.25;Mt=function(c,f){f=f||{};var l=typeof c;if(l==="string"&&c.length>0)return s(c);if(l==="number"&&isFinite(c))return f.long?u(c):a(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function s(c){if(c=String(c),!(c.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(f){var l=parseFloat(f[1]),p=(f[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return l*o;case"weeks":case"week":case"w":return l*i;case"days":case"day":case"d":return l*r;case"hours":case"hour":case"hrs":case"hr":case"h":return l*n;case"minutes":case"minute":case"mins":case"min":case"m":return l*t;case"seconds":case"second":case"secs":case"sec":case"s":return l*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function a(c){var f=Math.abs(c);return f>=r?Math.round(c/r)+"d":f>=n?Math.round(c/n)+"h":f>=t?Math.round(c/t)+"m":f>=e?Math.round(c/e)+"s":c+"ms"}function u(c){var f=Math.abs(c);return f>=r?d(c,f,r,"day"):f>=n?d(c,f,n,"hour"):f>=t?d(c,f,t,"minute"):f>=e?d(c,f,e,"second"):c+" ms"}function d(c,f,l,p){var h=f>=l*1.5;return Math.round(c/l)+" "+p+(h?"s":"")}return Mt}var At,Sn;function wn(){if(Sn)return At;Sn=1;function e(t){r.debug=r,r.default=r,r.coerce=d,r.disable=s,r.enable=o,r.enabled=a,r.humanize=vo(),r.destroy=c,Object.keys(t).forEach(f=>{r[f]=t[f]}),r.names=[],r.skips=[],r.formatters={};function n(f){let l=0;for(let p=0;p<f.length;p++)l=(l<<5)-l+f.charCodeAt(p),l|=0;return r.colors[Math.abs(l)%r.colors.length]}r.selectColor=n;function r(f){let l,p=null,h,S;function m(...g){if(!m.enabled)return;const C=m,O=Number(new Date),$=O-(l||O);C.diff=$,C.prev=l,C.curr=O,l=O,g[0]=r.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let w=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(ae,ge)=>{if(ae==="%%")return"%";w++;const F=r.formatters[ge];if(typeof F=="function"){const T=g[w];ae=F.call(C,T),g.splice(w,1),w--}return ae}),r.formatArgs.call(C,g),(C.log||r.log).apply(C,g)}return m.namespace=f,m.useColors=r.useColors(),m.color=r.selectColor(f),m.extend=i,m.destroy=r.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(h!==r.namespaces&&(h=r.namespaces,S=r.enabled(f)),S),set:g=>{p=g}}),typeof r.init=="function"&&r.init(m),m}function i(f,l){const p=r(this.namespace+(typeof l>"u"?":":l)+f);return p.log=this.log,p}function o(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let l;const p=(typeof f=="string"?f:"").split(/[\s,]+/),h=p.length;for(l=0;l<h;l++)p[l]&&(f=p[l].replace(/\*/g,".*?"),f[0]==="-"?r.skips.push(new RegExp("^"+f.slice(1)+"$")):r.names.push(new RegExp("^"+f+"$")))}function s(){const f=[...r.names.map(u),...r.skips.map(u).map(l=>"-"+l)].join(",");return r.enable(""),f}function a(f){if(f[f.length-1]==="*")return!0;let l,p;for(l=0,p=r.skips.length;l<p;l++)if(r.skips[l].test(f))return!1;for(l=0,p=r.names.length;l<p;l++)if(r.names[l].test(f))return!0;return!1}function u(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function d(f){return f instanceof Error?f.stack||f.message:f}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return At=e,At}var En;function So(){return En||(En=1,function(e,t){t.formatArgs=r,t.save=i,t.load=o,t.useColors=n,t.storage=s(),t.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let c=0,f=0;u[0].replace(/%[a-zA-Z%]/g,l=>{l!=="%%"&&(c++,l==="%c"&&(f=c))}),u.splice(f,0,d)}t.log=console.debug||console.log||(()=>{});function i(u){try{u?t.storage.setItem("debug",u):t.storage.removeItem("debug")}catch{}}function o(){let u;try{u=t.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=process.env.DEBUG),u}function s(){try{return localStorage}catch{}}e.exports=wn()(t);const{formatters:a}=e.exports;a.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}(tt,tt.exports)),tt.exports}var nt={exports:{}},It,$n;function wo(){return $n||($n=1,It=(e,t=process.argv)=>{const n=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(n+e),i=t.indexOf("--");return r!==-1&&(i===-1||r<i)}),It}var Lt,Fn;function Eo(){if(Fn)return Lt;Fn=1;const e=ve,t=mn,n=wo(),{env:r}=process;let i;n("no-color")||n("no-colors")||n("color=false")||n("color=never")?i=0:(n("color")||n("colors")||n("color=true")||n("color=always"))&&(i=1),"FORCE_COLOR"in r&&(r.FORCE_COLOR==="true"?i=1:r.FORCE_COLOR==="false"?i=0:i=r.FORCE_COLOR.length===0?1:Math.min(parseInt(r.FORCE_COLOR,10),3));function o(u){return u===0?!1:{level:u,hasBasic:!0,has256:u>=2,has16m:u>=3}}function s(u,d){if(i===0)return 0;if(n("color=16m")||n("color=full")||n("color=truecolor"))return 3;if(n("color=256"))return 2;if(u&&!d&&i===void 0)return 0;const c=i||0;if(r.TERM==="dumb")return c;if(process.platform==="win32"){const f=e.release().split(".");return Number(f[0])>=10&&Number(f[2])>=10586?Number(f[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(f=>f in r)||r.CI_NAME==="codeship"?1:c;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in r){const f=parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return f>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:c}function a(u){const d=s(u,u&&u.isTTY);return o(d)}return Lt={supportsColor:a,stdout:o(s(!0,t.isatty(1))),stderr:o(s(!0,t.isatty(2)))},Lt}var Cn;function $o(){return Cn||(Cn=1,function(e,t){const n=mn,r=je;t.init=c,t.log=a,t.formatArgs=o,t.save=u,t.load=d,t.useColors=i,t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const l=Eo();l&&(l.stderr||l).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}t.inspectOpts=Object.keys(process.env).filter(l=>/^debug_/i.test(l)).reduce((l,p)=>{const h=p.substring(6).toLowerCase().replace(/_([a-z])/g,(m,g)=>g.toUpperCase());let S=process.env[p];return/^(yes|on|true|enabled)$/i.test(S)?S=!0:/^(no|off|false|disabled)$/i.test(S)?S=!1:S==="null"?S=null:S=Number(S),l[h]=S,l},{});function i(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:n.isatty(process.stderr.fd)}function o(l){const{namespace:p,useColors:h}=this;if(h){const S=this.color,m="\x1B[3"+(S<8?S:"8;5;"+S),g=`  ${m};1m${p} \x1B[0m`;l[0]=g+l[0].split(`
`).join(`
`+g),l.push(m+"m+"+e.exports.humanize(this.diff)+"\x1B[0m")}else l[0]=s()+p+" "+l[0]}function s(){return t.inspectOpts.hideDate?"":new Date().toISOString()+" "}function a(...l){return process.stderr.write(r.format(...l)+`
`)}function u(l){l?process.env.DEBUG=l:delete process.env.DEBUG}function d(){return process.env.DEBUG}function c(l){l.inspectOpts={};const p=Object.keys(t.inspectOpts);for(let h=0;h<p.length;h++)l.inspectOpts[p[h]]=t.inspectOpts[p[h]]}e.exports=wn()(t);const{formatters:f}=e.exports;f.o=function(l){return this.inspectOpts.colors=this.useColors,r.inspect(l,this.inspectOpts).split(`
`).map(p=>p.trim()).join(" ")},f.O=function(l){return this.inspectOpts.colors=this.useColors,r.inspect(l,this.inspectOpts)}}(nt,nt.exports)),nt.exports}typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?bt.exports=So():bt.exports=$o();var W=bt.exports,Fo=Co;function Te(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}function Co(e){if(e=e||{},e.circles)return Oo(e);return e.proto?r:n;function t(i,o){for(var s=Object.keys(i),a=new Array(s.length),u=0;u<s.length;u++){var d=s[u],c=i[d];typeof c!="object"||c===null?a[d]=c:c instanceof Date?a[d]=new Date(c):ArrayBuffer.isView(c)?a[d]=Te(c):a[d]=o(c)}return a}function n(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return t(i,n);if(i instanceof Map)return new Map(t(Array.from(i),n));if(i instanceof Set)return new Set(t(Array.from(i),n));var o={};for(var s in i)if(Object.hasOwnProperty.call(i,s)!==!1){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(t(Array.from(a),n)):a instanceof Set?o[s]=new Set(t(Array.from(a),n)):ArrayBuffer.isView(a)?o[s]=Te(a):o[s]=n(a)}return o}function r(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return t(i,r);if(i instanceof Map)return new Map(t(Array.from(i),r));if(i instanceof Set)return new Set(t(Array.from(i),r));var o={};for(var s in i){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(t(Array.from(a),r)):a instanceof Set?o[s]=new Set(t(Array.from(a),r)):ArrayBuffer.isView(a)?o[s]=Te(a):o[s]=r(a)}return o}}function Oo(e){var t=[],n=[];return e.proto?o:i;function r(s,a){for(var u=Object.keys(s),d=new Array(u.length),c=0;c<u.length;c++){var f=u[c],l=s[f];if(typeof l!="object"||l===null)d[f]=l;else if(l instanceof Date)d[f]=new Date(l);else if(ArrayBuffer.isView(l))d[f]=Te(l);else{var p=t.indexOf(l);p!==-1?d[f]=n[p]:d[f]=a(l)}}return d}function i(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return r(s,i);if(s instanceof Map)return new Map(r(Array.from(s),i));if(s instanceof Set)return new Set(r(Array.from(s),i));var a={};t.push(s),n.push(a);for(var u in s)if(Object.hasOwnProperty.call(s,u)!==!1){var d=s[u];if(typeof d!="object"||d===null)a[u]=d;else if(d instanceof Date)a[u]=new Date(d);else if(d instanceof Map)a[u]=new Map(r(Array.from(d),i));else if(d instanceof Set)a[u]=new Set(r(Array.from(d),i));else if(ArrayBuffer.isView(d))a[u]=Te(d);else{var c=t.indexOf(d);c!==-1?a[u]=n[c]:a[u]=i(d)}}return t.pop(),n.pop(),a}function o(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return r(s,o);if(s instanceof Map)return new Map(r(Array.from(s),o));if(s instanceof Set)return new Set(r(Array.from(s),o));var a={};t.push(s),n.push(a);for(var u in s){var d=s[u];if(typeof d!="object"||d===null)a[u]=d;else if(d instanceof Date)a[u]=new Date(d);else if(d instanceof Map)a[u]=new Map(r(Array.from(d),o));else if(d instanceof Set)a[u]=new Set(r(Array.from(d),o));else if(ArrayBuffer.isView(d))a[u]=Te(d);else{var c=t.indexOf(d);c!==-1?a[u]=n[c]:a[u]=o(d)}}return t.pop(),n.pop(),a}}const xo=je,Se=W("log4js:configuration"),rt=[],it=[],On=e=>!e,xn=e=>e&&typeof e=="object"&&!Array.isArray(e),To=e=>/^[A-Za-z][A-Za-z0-9_]*$/g.test(e),_o=e=>e&&typeof e=="number"&&Number.isInteger(e),No=e=>{it.push(e),Se(`Added listener, now ${it.length} listeners`)},bo=e=>{rt.push(e),Se(`Added pre-processing listener, now ${rt.length} listeners`)},Tn=(e,t,n)=>{(Array.isArray(t)?t:[t]).forEach(i=>{if(i)throw new Error(`Problem with log4js configuration: (${xo.inspect(e,{depth:5})}) - ${n}`)})},Mo=e=>{Se("New configuration to be validated: ",e),Tn(e,On(xn(e)),"must be an object."),Se(`Calling pre-processing listeners (${rt.length})`),rt.forEach(t=>t(e)),Se("Configuration pre-processing finished."),Se(`Calling configuration listeners (${it.length})`),it.forEach(t=>t(e)),Se("Configuration finished.")};var _e={configure:Mo,addListener:No,addPreProcessingListener:bo,throwExceptionIf:Tn,anObject:xn,anInteger:_o,validIdentifier:To,not:On},_n={exports:{}};(function(e){function t(d,c){for(var f=d.toString();f.length<c;)f="0"+f;return f}function n(d){return t(d,2)}function r(d){var c=Math.abs(d),f=String(Math.floor(c/60)),l=String(c%60);return f=("0"+f).slice(-2),l=("0"+l).slice(-2),d===0?"Z":(d<0?"+":"-")+f+":"+l}function i(d,c){typeof d!="string"&&(c=d,d=e.exports.ISO8601_FORMAT),c||(c=e.exports.now());var f=n(c.getDate()),l=n(c.getMonth()+1),p=n(c.getFullYear()),h=n(p.substring(2,4)),S=d.indexOf("yyyy")>-1?p:h,m=n(c.getHours()),g=n(c.getMinutes()),C=n(c.getSeconds()),O=t(c.getMilliseconds(),3),$=r(c.getTimezoneOffset()),w=d.replace(/dd/g,f).replace(/MM/g,l).replace(/y{1,4}/g,S).replace(/hh/g,m).replace(/mm/g,g).replace(/ss/g,C).replace(/SSS/g,O).replace(/O/g,$);return w}function o(d,c,f,l){d["set"+(l?"":"UTC")+c](f)}function s(d,c,f){var l=d.indexOf("O")<0,p=!1,h=[{pattern:/y{1,4}/,regexp:"\\d{1,4}",fn:function($,w){o($,"FullYear",w,l)}},{pattern:/MM/,regexp:"\\d{1,2}",fn:function($,w){o($,"Month",w-1,l),$.getMonth()!==w-1&&(p=!0)}},{pattern:/dd/,regexp:"\\d{1,2}",fn:function($,w){p&&o($,"Month",$.getMonth()-1,l),o($,"Date",w,l)}},{pattern:/hh/,regexp:"\\d{1,2}",fn:function($,w){o($,"Hours",w,l)}},{pattern:/mm/,regexp:"\\d\\d",fn:function($,w){o($,"Minutes",w,l)}},{pattern:/ss/,regexp:"\\d\\d",fn:function($,w){o($,"Seconds",w,l)}},{pattern:/SSS/,regexp:"\\d\\d\\d",fn:function($,w){o($,"Milliseconds",w,l)}},{pattern:/O/,regexp:"[+-]\\d{1,2}:?\\d{2}?|Z",fn:function($,w){w==="Z"?w=0:w=w.replace(":","");var ee=Math.abs(w),ae=(w>0?-1:1)*(ee%100+Math.floor(ee/100)*60);$.setUTCMinutes($.getUTCMinutes()+ae)}}],S=h.reduce(function($,w){return w.pattern.test($.regexp)?(w.index=$.regexp.match(w.pattern).index,$.regexp=$.regexp.replace(w.pattern,"("+w.regexp+")")):w.index=-1,$},{regexp:d,index:[]}),m=h.filter(function($){return $.index>-1});m.sort(function($,w){return $.index-w.index});var g=new RegExp(S.regexp),C=g.exec(c);if(C){var O=f||e.exports.now();return m.forEach(function($,w){$.fn(O,C[w+1])}),O}throw new Error("String '"+c+"' could not be parsed as '"+d+"'")}function a(d,c,f){if(!d)throw new Error("pattern must be supplied");return s(d,c,f)}function u(){return new Date}e.exports=i,e.exports.asString=i,e.exports.parse=a,e.exports.now=u,e.exports.ISO8601_FORMAT="yyyy-MM-ddThh:mm:ss.SSS",e.exports.ISO8601_WITH_TZ_OFFSET_FORMAT="yyyy-MM-ddThh:mm:ss.SSSO",e.exports.DATETIME_FORMAT="dd MM yyyy hh:mm:ss.SSS",e.exports.ABSOLUTETIME_FORMAT="hh:mm:ss.SSS"})(_n);var kt=_n.exports;const de=kt,Nn=ve,De=je,Re=M,bn=mo,Mn=W("log4js:layouts"),An={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[90,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[91,39],yellow:[33,39]};function In(e){return e?`\x1B[${An[e][0]}m`:""}function Ln(e){return e?`\x1B[${An[e][1]}m`:""}function Ao(e,t){return In(t)+e+Ln(t)}function kn(e,t){return Ao(De.format("[%s] [%s] %s - ",de.asString(e.startTime),e.level.toString(),e.categoryName),t)}function jn(e){return kn(e)+De.format(...e.data)}function ot(e){return kn(e,e.level.colour)+De.format(...e.data)}function Dn(e){return De.format(...e.data)}function Rn(e){return e.data[0]}function Pn(e,t){const n="%r %p %c - %m%n",r=/%(-?[0-9]+)?(\.?-?[0-9]+)?([[\]cdhmnprzxXyflosCMAF%])(\{([^}]+)\})?|([^%]+)/;e=e||n;function i(y,E){let v=y.categoryName;if(E){const N=parseInt(E,10),x=v.split(".");N<x.length&&(v=x.slice(x.length-N).join("."))}return v}function o(y,E){let v=de.ISO8601_FORMAT;if(E)switch(v=E,v){case"ISO8601":case"ISO8601_FORMAT":v=de.ISO8601_FORMAT;break;case"ISO8601_WITH_TZ_OFFSET":case"ISO8601_WITH_TZ_OFFSET_FORMAT":v=de.ISO8601_WITH_TZ_OFFSET_FORMAT;break;case"ABSOLUTE":process.emitWarning("Pattern %d{ABSOLUTE} is deprecated in favor of %d{ABSOLUTETIME}. Please use %d{ABSOLUTETIME} instead.","DeprecationWarning","log4js-node-DEP0003"),Mn("[log4js-node-DEP0003]","DEPRECATION: Pattern %d{ABSOLUTE} is deprecated and replaced by %d{ABSOLUTETIME}.");case"ABSOLUTETIME":case"ABSOLUTETIME_FORMAT":v=de.ABSOLUTETIME_FORMAT;break;case"DATE":process.emitWarning("Pattern %d{DATE} is deprecated due to the confusion it causes when used. Please use %d{DATETIME} instead.","DeprecationWarning","log4js-node-DEP0004"),Mn("[log4js-node-DEP0004]","DEPRECATION: Pattern %d{DATE} is deprecated and replaced by %d{DATETIME}.");case"DATETIME":case"DATETIME_FORMAT":v=de.DATETIME_FORMAT;break}return de.asString(v,y.startTime)}function s(){return Nn.hostname().toString()}function a(y){return De.format(...y.data)}function u(){return Nn.EOL}function d(y){return y.level.toString()}function c(y){return de.asString("hh:mm:ss",y.startTime)}function f(y){return In(y.level.colour)}function l(y){return Ln(y.level.colour)}function p(){return"%"}function h(y){return y&&y.pid?y.pid.toString():process.pid.toString()}function S(){return h()}function m(y,E){return typeof t[E]<"u"?typeof t[E]=="function"?t[E](y):t[E]:null}function g(y,E){const v=y.context[E];return typeof v<"u"?typeof v=="function"?v(y):v:null}function C(y,E){let v=y.fileName||"";if(v=function(x){const fe="file://";return x.startsWith(fe)&&(typeof bn.fileURLToPath=="function"?x=bn.fileURLToPath(x):(x=Re.normalize(x.replace(new RegExp(`^${fe}`),"")),process.platform==="win32"&&(x.startsWith("\\")?x=x.slice(1):x=Re.sep+Re.sep+x))),x}(v),E){const x=parseInt(E,10),fe=v.split(Re.sep);fe.length>x&&(v=fe.slice(-x).join(Re.sep))}return v}function O(y){return y.lineNumber?`${y.lineNumber}`:""}function $(y){return y.columnNumber?`${y.columnNumber}`:""}function w(y){return y.callStack||""}function ee(y){return y.className||""}function ae(y){return y.functionName||""}function ge(y){return y.functionAlias||""}function F(y){return y.callerName||""}const T={c:i,d:o,h:s,m:a,n:u,p:d,r:c,"[":f,"]":l,y:S,z:h,"%":p,x:m,X:g,f:C,l:O,o:$,s:w,C:ee,M:ae,A:ge,F};function _(y,E,v){return T[y](E,v)}function D(y,E){let v;return y?(v=parseInt(y.slice(1),10),v>0?E.slice(0,v):E.slice(v)):E}function R(y,E){let v;if(y)if(y.charAt(0)==="-")for(v=parseInt(y.slice(1),10);E.length<v;)E+=" ";else for(v=parseInt(y,10);E.length<v;)E=` ${E}`;return E}function L(y,E,v){let N=y;return N=D(E,N),N=R(v,N),N}return function(y){let E="",v,N=e;for(;(v=r.exec(N))!==null;){const x=v[1],fe=v[2],lo=v[3],fo=v[5],pn=v[6];if(pn)E+=pn.toString();else{const po=_(lo,y,fo);E+=L(po,fe,x)}N=N.slice(v.index+v[0].length)}return E}}const jt={messagePassThrough(){return Dn},basic(){return jn},colored(){return ot},coloured(){return ot},pattern(e){return Pn(e&&e.pattern,e&&e.tokens)},dummy(){return Rn}};var Wn={basicLayout:jn,messagePassThroughLayout:Dn,patternLayout:Pn,colouredLayout:ot,coloredLayout:ot,dummyLayout:Rn,addLayout(e,t){jt[e]=t},layout(e,t){return jt[e]&&jt[e](t)}};const k=_e,Bn=["white","grey","black","blue","cyan","green","magenta","red","yellow"];class P{constructor(t,n,r){this.level=t,this.levelStr=n,this.colour=r}toString(){return this.levelStr}static getLevel(t,n){return t?t instanceof P?t:(t instanceof Object&&t.levelStr&&(t=t.levelStr),P[t.toString().toUpperCase()]||n):n}static addLevels(t){t&&(Object.keys(t).forEach(r=>{const i=r.toUpperCase();P[i]=new P(t[r].value,i,t[r].colour);const o=P.levels.findIndex(s=>s.levelStr===i);o>-1?P.levels[o]=P[i]:P.levels.push(P[i])}),P.levels.sort((r,i)=>r.level-i.level))}isLessThanOrEqualTo(t){return typeof t=="string"&&(t=P.getLevel(t)),this.level<=t.level}isGreaterThanOrEqualTo(t){return typeof t=="string"&&(t=P.getLevel(t)),this.level>=t.level}isEqualTo(t){return typeof t=="string"&&(t=P.getLevel(t)),this.level===t.level}}P.levels=[],P.addLevels({ALL:{value:Number.MIN_VALUE,colour:"grey"},TRACE:{value:5e3,colour:"blue"},DEBUG:{value:1e4,colour:"cyan"},INFO:{value:2e4,colour:"green"},WARN:{value:3e4,colour:"yellow"},ERROR:{value:4e4,colour:"red"},FATAL:{value:5e4,colour:"magenta"},MARK:{value:9007199254740992,colour:"grey"},OFF:{value:Number.MAX_VALUE,colour:"grey"}}),k.addListener(e=>{const t=e.levels;t&&(k.throwExceptionIf(e,k.not(k.anObject(t)),"levels must be an object"),Object.keys(t).forEach(r=>{k.throwExceptionIf(e,k.not(k.validIdentifier(r)),`level name "${r}" is not a valid identifier (must start with a letter, only contain A-Z,a-z,0-9,_)`),k.throwExceptionIf(e,k.not(k.anObject(t[r])),`level "${r}" must be an object`),k.throwExceptionIf(e,k.not(t[r].value),`level "${r}" must have a 'value' property`),k.throwExceptionIf(e,k.not(k.anInteger(t[r].value)),`level "${r}".value must have an integer value`),k.throwExceptionIf(e,k.not(t[r].colour),`level "${r}" must have a 'colour' property`),k.throwExceptionIf(e,k.not(Bn.indexOf(t[r].colour)>-1),`level "${r}".colour must be one of ${Bn.join(", ")}`)}))}),k.addListener(e=>{P.addLevels(e.levels)});var Ne=P;function Io(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Dt={exports:{}},Pe={};const{parse:Un,stringify:zn}=JSON,{keys:Lo}=Object,We=String,Jn="string",Gn={},st="object",qn=(e,t)=>t,ko=e=>e instanceof We?We(e):e,jo=(e,t)=>typeof t===Jn?new We(t):t,Hn=(e,t,n,r)=>{const i=[];for(let o=Lo(n),{length:s}=o,a=0;a<s;a++){const u=o[a],d=n[u];if(d instanceof We){const c=e[d];typeof c===st&&!t.has(c)?(t.add(c),n[u]=Gn,i.push({k:u,a:[e,t,c,r]})):n[u]=r.call(n,u,c)}else n[u]!==Gn&&(n[u]=r.call(n,u,d))}for(let{length:o}=i,s=0;s<o;s++){const{k:a,a:u}=i[s];n[a]=r.call(n,a,Hn.apply(null,u))}return n},Vn=(e,t,n)=>{const r=We(t.push(n)-1);return e.set(n,r),r},Kn=(e,t)=>{const n=Un(e,jo).map(ko),r=n[0],i=t||qn,o=typeof r===st&&r?Hn(n,new Set,r,i):r;return i.call({"":o},"",o)};Pe.parse=Kn;const Yn=(e,t,n)=>{const r=t&&typeof t===st?(c,f)=>c===""||-1<t.indexOf(c)?f:void 0:t||qn,i=new Map,o=[],s=[];let a=+Vn(i,o,r.call({"":e},"",e)),u=!a;for(;a<o.length;)u=!0,s[a]=zn(o[a++],d,n);return"["+s.join(",")+"]";function d(c,f){if(u)return u=!u,f;const l=r.call(this,c,f);switch(typeof l){case st:if(l===null)return l;case Jn:return i.get(l)||Vn(i,o,l)}return l}};Pe.stringify=Yn;const Do=e=>Un(Yn(e));Pe.toJSON=Do;const Ro=e=>Kn(zn(e));Pe.fromJSON=Ro;const Zn=Pe,Xn=Ne;class Po{constructor(){const t={__LOG4JS_undefined__:void 0,__LOG4JS_NaN__:+"abc",__LOG4JS_Infinity__:1/0,"__LOG4JS_-Infinity__":-1/0};this.deMap=t,this.serMap={},Object.keys(this.deMap).forEach(n=>{const r=this.deMap[n];this.serMap[r]=n})}canSerialise(t){return typeof t=="string"?!1:t in this.serMap}serialise(t){return this.canSerialise(t)?this.serMap[t]:t}canDeserialise(t){return t in this.deMap}deserialise(t){return this.canDeserialise(t)?this.deMap[t]:t}}const Qn=new Po;let Wo=class dn{constructor(t,n,r,i,o,s){if(this.startTime=new Date,this.categoryName=t,this.data=r,this.level=n,this.context=Object.assign({},i),this.pid=process.pid,this.error=s,typeof o<"u"){if(!o||typeof o!="object"||Array.isArray(o))throw new TypeError("Invalid location type passed to LoggingEvent constructor");this.constructor._getLocationKeys().forEach(a=>{typeof o[a]<"u"&&(this[a]=o[a])})}}static _getLocationKeys(){return["fileName","lineNumber","columnNumber","callStack","className","functionName","functionAlias","callerName"]}serialise(){return Zn.stringify(this,(t,n)=>(n instanceof Error&&(n=Object.assign({message:n.message,stack:n.stack},n)),Qn.serialise(n)))}static deserialise(t){let n;try{const r=Zn.parse(t,(i,o)=>{if(o&&o.message&&o.stack){const s=new Error(o);Object.keys(o).forEach(a=>{s[a]=o[a]}),o=s}return Qn.deserialise(o)});this._getLocationKeys().forEach(i=>{typeof r[i]<"u"&&(r.location||(r.location={}),r.location[i]=r[i])}),n=new dn(r.categoryName,Xn.getLevel(r.level.levelStr),r.data,r.context,r.location,r.error),n.startTime=new Date(r.startTime),n.pid=r.pid,r.cluster&&(n.cluster=r.cluster)}catch(r){n=new dn("log4js",Xn.ERROR,["Unable to parse log:",t,"because: ",r])}return n}};var er=Wo;const K=W("log4js:clustering"),Bo=er,Uo=_e;let be=!1,Y=null;try{Y=require("cluster")}catch{K("cluster module not present"),be=!0}const Rt=[];let Be=!1,Ue="NODE_APP_INSTANCE";const tr=()=>Be&&process.env[Ue]==="0",Pt=()=>be||Y&&Y.isMaster||tr(),nr=e=>{Rt.forEach(t=>t(e))},at=(e,t)=>{if(K("cluster message received from worker ",e,": ",t),e.topic&&e.data&&(t=e,e=void 0),t&&t.topic&&t.topic==="log4js:message"){K("received message: ",t.data);const n=Bo.deserialise(t.data);nr(n)}};be||Uo.addListener(e=>{Rt.length=0,{pm2:Be,disableClustering:be,pm2InstanceVar:Ue="NODE_APP_INSTANCE"}=e,K(`clustering disabled ? ${be}`),K(`cluster.isMaster ? ${Y&&Y.isMaster}`),K(`pm2 enabled ? ${Be}`),K(`pm2InstanceVar = ${Ue}`),K(`process.env[${Ue}] = ${process.env[Ue]}`),Be&&process.removeListener("message",at),Y&&Y.removeListener&&Y.removeListener("message",at),be||e.disableClustering?K("Not listening for cluster messages, because clustering disabled."):tr()?(K("listening for PM2 broadcast messages"),process.on("message",at)):Y&&Y.isMaster?(K("listening for cluster messages"),Y.on("message",at)):K("not listening for messages, because we are not a master process")});var Wt={onlyOnMaster:(e,t)=>Pt()?e():t,isMaster:Pt,send:e=>{Pt()?nr(e):(Be||(e.cluster={workerId:Y.worker.id,worker:process.pid}),process.send({topic:"log4js:message",data:e.serialise()}))},onMessage:e=>{Rt.push(e)}},rr={};function zo(e){if(typeof e=="number"&&Number.isInteger(e))return e;const t={K:1024,M:1024*1024,G:1024*1024*1024},n=Object.keys(t),r=e.slice(-1).toLocaleUpperCase(),i=e.slice(0,-1).trim();if(n.indexOf(r)<0||!Number.isInteger(Number(i)))throw Error(`maxLogSize: "${e}" is invalid`);return i*t[r]}function Jo(e,t){const n=Object.assign({},t);return Object.keys(e).forEach(r=>{n[r]&&(n[r]=e[r](t[r]))}),n}function Bt(e){return Jo({maxLogSize:zo},e)}const ir={dateFile:Bt,file:Bt,fileSync:Bt};rr.modifyConfig=e=>ir[e.type]?ir[e.type](e):e;var or={};const Go=console.log.bind(console);function qo(e,t){return n=>{Go(e(n,t))}}function Ho(e,t){let n=t.colouredLayout;return e.layout&&(n=t.layout(e.layout.type,e.layout)),qo(n,e.timezoneOffset)}or.configure=Ho;var sr={};function Vo(e,t){return n=>{process.stdout.write(`${e(n,t)}
`)}}function Ko(e,t){let n=t.colouredLayout;return e.layout&&(n=t.layout(e.layout.type,e.layout)),Vo(n,e.timezoneOffset)}sr.configure=Ko;var ar={};function Yo(e,t){return n=>{process.stderr.write(`${e(n,t)}
`)}}function Zo(e,t){let n=t.colouredLayout;return e.layout&&(n=t.layout(e.layout.type,e.layout)),Yo(n,e.timezoneOffset)}ar.configure=Zo;var cr={};function Xo(e,t,n,r){const i=r.getLevel(e),o=r.getLevel(t,r.FATAL);return s=>{const a=s.level;i.isLessThanOrEqualTo(a)&&o.isGreaterThanOrEqualTo(a)&&n(s)}}function Qo(e,t,n,r){const i=n(e.appender);return Xo(e.level,e.maxLevel,i,r)}cr.configure=Qo;var ur={};const lr=W("log4js:categoryFilter");function es(e,t){return typeof e=="string"&&(e=[e]),n=>{lr(`Checking ${n.categoryName} against ${e}`),e.indexOf(n.categoryName)===-1&&(lr("Not excluded, sending to appender"),t(n))}}function ts(e,t,n){const r=n(e.appender);return es(e.exclude,r)}ur.configure=ts;var fr={};const dr=W("log4js:noLogFilter");function ns(e){return e.filter(n=>n!=null&&n!=="")}function rs(e,t){return n=>{dr(`Checking data: ${n.data} against filters: ${e}`),typeof e=="string"&&(e=[e]),e=ns(e);const r=new RegExp(e.join("|"),"i");(e.length===0||n.data.findIndex(i=>r.test(i))<0)&&(dr("Not excluded, sending to appender"),t(n))}}function is(e,t,n){const r=n(e.appender);return rs(e.exclude,r)}fr.configure=is;var pr={},mr={exports:{}},Ut={},J={};J.fromCallback=function(e){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")e.apply(this,arguments);else return new Promise((t,n)=>{arguments[arguments.length]=(r,i)=>{if(r)return n(r);t(i)},arguments.length++,e.apply(this,arguments)})},"name",{value:e.name})},J.fromPromise=function(e){return Object.defineProperty(function(){const t=arguments[arguments.length-1];if(typeof t!="function")return e.apply(this,arguments);e.apply(this,arguments).then(n=>t(null,n),t)},"name",{value:e.name})};var pe=ho,os=process.cwd,ct=null,ss=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return ct||(ct=os.call(process)),ct};try{process.cwd()}catch{}if(typeof process.chdir=="function"){var hr=process.chdir;process.chdir=function(e){ct=null,hr.call(process,e)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,hr)}var as=cs;function cs(e){pe.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&t(e),e.lutimes||n(e),e.chown=o(e.chown),e.fchown=o(e.fchown),e.lchown=o(e.lchown),e.chmod=r(e.chmod),e.fchmod=r(e.fchmod),e.lchmod=r(e.lchmod),e.chownSync=s(e.chownSync),e.fchownSync=s(e.fchownSync),e.lchownSync=s(e.lchownSync),e.chmodSync=i(e.chmodSync),e.fchmodSync=i(e.fchmodSync),e.lchmodSync=i(e.lchmodSync),e.stat=a(e.stat),e.fstat=a(e.fstat),e.lstat=a(e.lstat),e.statSync=u(e.statSync),e.fstatSync=u(e.fstatSync),e.lstatSync=u(e.lstatSync),e.chmod&&!e.lchmod&&(e.lchmod=function(c,f,l){l&&process.nextTick(l)},e.lchmodSync=function(){}),e.chown&&!e.lchown&&(e.lchown=function(c,f,l,p){p&&process.nextTick(p)},e.lchownSync=function(){}),ss==="win32"&&(e.rename=typeof e.rename!="function"?e.rename:function(c){function f(l,p,h){var S=Date.now(),m=0;c(l,p,function g(C){if(C&&(C.code==="EACCES"||C.code==="EPERM"||C.code==="EBUSY")&&Date.now()-S<6e4){setTimeout(function(){e.stat(p,function(O,$){O&&O.code==="ENOENT"?c(l,p,g):h(C)})},m),m<100&&(m+=10);return}h&&h(C)})}return Object.setPrototypeOf&&Object.setPrototypeOf(f,c),f}(e.rename)),e.read=typeof e.read!="function"?e.read:function(c){function f(l,p,h,S,m,g){var C;if(g&&typeof g=="function"){var O=0;C=function($,w,ee){if($&&$.code==="EAGAIN"&&O<10)return O++,c.call(e,l,p,h,S,m,C);g.apply(this,arguments)}}return c.call(e,l,p,h,S,m,C)}return Object.setPrototypeOf&&Object.setPrototypeOf(f,c),f}(e.read),e.readSync=typeof e.readSync!="function"?e.readSync:function(c){return function(f,l,p,h,S){for(var m=0;;)try{return c.call(e,f,l,p,h,S)}catch(g){if(g.code==="EAGAIN"&&m<10){m++;continue}throw g}}}(e.readSync);function t(c){c.lchmod=function(f,l,p){c.open(f,pe.O_WRONLY|pe.O_SYMLINK,l,function(h,S){if(h){p&&p(h);return}c.fchmod(S,l,function(m){c.close(S,function(g){p&&p(m||g)})})})},c.lchmodSync=function(f,l){var p=c.openSync(f,pe.O_WRONLY|pe.O_SYMLINK,l),h=!0,S;try{S=c.fchmodSync(p,l),h=!1}finally{if(h)try{c.closeSync(p)}catch{}else c.closeSync(p)}return S}}function n(c){pe.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(f,l,p,h){c.open(f,pe.O_SYMLINK,function(S,m){if(S){h&&h(S);return}c.futimes(m,l,p,function(g){c.close(m,function(C){h&&h(g||C)})})})},c.lutimesSync=function(f,l,p){var h=c.openSync(f,pe.O_SYMLINK),S,m=!0;try{S=c.futimesSync(h,l,p),m=!1}finally{if(m)try{c.closeSync(h)}catch{}else c.closeSync(h)}return S}):c.futimes&&(c.lutimes=function(f,l,p,h){h&&process.nextTick(h)},c.lutimesSync=function(){})}function r(c){return c&&function(f,l,p){return c.call(e,f,l,function(h){d(h)&&(h=null),p&&p.apply(this,arguments)})}}function i(c){return c&&function(f,l){try{return c.call(e,f,l)}catch(p){if(!d(p))throw p}}}function o(c){return c&&function(f,l,p,h){return c.call(e,f,l,p,function(S){d(S)&&(S=null),h&&h.apply(this,arguments)})}}function s(c){return c&&function(f,l,p){try{return c.call(e,f,l,p)}catch(h){if(!d(h))throw h}}}function a(c){return c&&function(f,l,p){typeof l=="function"&&(p=l,l=null);function h(S,m){m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),p&&p.apply(this,arguments)}return l?c.call(e,f,l,h):c.call(e,f,h)}}function u(c){return c&&function(f,l){var p=l?c.call(e,f,l):c.call(e,f);return p&&(p.uid<0&&(p.uid+=4294967296),p.gid<0&&(p.gid+=4294967296)),p}}function d(c){if(!c||c.code==="ENOSYS")return!0;var f=!process.getuid||process.getuid()!==0;return!!(f&&(c.code==="EINVAL"||c.code==="EPERM"))}}var yr=hn.Stream,us=ls;function ls(e){return{ReadStream:t,WriteStream:n};function t(r,i){if(!(this instanceof t))return new t(r,i);yr.call(this);var o=this;this.path=r,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,u=s.length;a<u;a++){var d=s[a];this[d]=i[d]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}e.open(this.path,this.flags,this.mode,function(c,f){if(c){o.emit("error",c),o.readable=!1;return}o.fd=f,o.emit("open",f),o._read()})}function n(r,i){if(!(this instanceof n))return new n(r,i);yr.call(this),this.path=r,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var u=o[s];this[u]=i[u]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}var fs=ps,ds=Object.getPrototypeOf||function(e){return e.__proto__};function ps(e){if(e===null||typeof e!="object")return e;if(e instanceof Object)var t={__proto__:ds(e)};else var t=Object.create(null);return Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}var I=Oe,ms=as,hs=us,ys=fs,ut=je,B,lt;typeof Symbol=="function"&&typeof Symbol.for=="function"?(B=Symbol.for("graceful-fs.queue"),lt=Symbol.for("graceful-fs.previous")):(B="___graceful-fs.queue",lt="___graceful-fs.previous");function gs(){}function gr(e,t){Object.defineProperty(e,B,{get:function(){return t}})}var we=gs;if(ut.debuglog?we=ut.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(we=function(){var e=ut.format.apply(ut,arguments);e="GFS4: "+e.split(/\n/).join(`
GFS4: `),console.error(e)}),!I[B]){var vs=Nt[B]||[];gr(I,vs),I.close=function(e){function t(n,r){return e.call(I,n,function(i){i||vr(),typeof r=="function"&&r.apply(this,arguments)})}return Object.defineProperty(t,lt,{value:e}),t}(I.close),I.closeSync=function(e){function t(n){e.apply(I,arguments),vr()}return Object.defineProperty(t,lt,{value:e}),t}(I.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){we(I[B]),yn.equal(I[B].length,0)})}Nt[B]||gr(Nt,I[B]);var j=zt(ys(I));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!I.__patched&&(j=zt(I),I.__patched=!0);function zt(e){ms(e),e.gracefulify=zt,e.createReadStream=w,e.createWriteStream=ee;var t=e.readFile;e.readFile=n;function n(F,T,_){return typeof T=="function"&&(_=T,T=null),D(F,T,_);function D(R,L,y,E){return t(R,L,function(v){v&&(v.code==="EMFILE"||v.code==="ENFILE")?Me([D,[R,L,y],v,E||Date.now(),Date.now()]):typeof y=="function"&&y.apply(this,arguments)})}}var r=e.writeFile;e.writeFile=i;function i(F,T,_,D){return typeof _=="function"&&(D=_,_=null),R(F,T,_,D);function R(L,y,E,v,N){return r(L,y,E,function(x){x&&(x.code==="EMFILE"||x.code==="ENFILE")?Me([R,[L,y,E,v],x,N||Date.now(),Date.now()]):typeof v=="function"&&v.apply(this,arguments)})}}var o=e.appendFile;o&&(e.appendFile=s);function s(F,T,_,D){return typeof _=="function"&&(D=_,_=null),R(F,T,_,D);function R(L,y,E,v,N){return o(L,y,E,function(x){x&&(x.code==="EMFILE"||x.code==="ENFILE")?Me([R,[L,y,E,v],x,N||Date.now(),Date.now()]):typeof v=="function"&&v.apply(this,arguments)})}}var a=e.copyFile;a&&(e.copyFile=u);function u(F,T,_,D){return typeof _=="function"&&(D=_,_=0),R(F,T,_,D);function R(L,y,E,v,N){return a(L,y,E,function(x){x&&(x.code==="EMFILE"||x.code==="ENFILE")?Me([R,[L,y,E,v],x,N||Date.now(),Date.now()]):typeof v=="function"&&v.apply(this,arguments)})}}var d=e.readdir;e.readdir=f;var c=/^v[0-5]\./;function f(F,T,_){typeof T=="function"&&(_=T,T=null);var D=c.test(process.version)?function(y,E,v,N){return d(y,R(y,E,v,N))}:function(y,E,v,N){return d(y,E,R(y,E,v,N))};return D(F,T,_);function R(L,y,E,v){return function(N,x){N&&(N.code==="EMFILE"||N.code==="ENFILE")?Me([D,[L,y,E],N,v||Date.now(),Date.now()]):(x&&x.sort&&x.sort(),typeof E=="function"&&E.call(this,N,x))}}}if(process.version.substr(0,4)==="v0.8"){var l=hs(e);g=l.ReadStream,O=l.WriteStream}var p=e.ReadStream;p&&(g.prototype=Object.create(p.prototype),g.prototype.open=C);var h=e.WriteStream;h&&(O.prototype=Object.create(h.prototype),O.prototype.open=$),Object.defineProperty(e,"ReadStream",{get:function(){return g},set:function(F){g=F},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WriteStream",{get:function(){return O},set:function(F){O=F},enumerable:!0,configurable:!0});var S=g;Object.defineProperty(e,"FileReadStream",{get:function(){return S},set:function(F){S=F},enumerable:!0,configurable:!0});var m=O;Object.defineProperty(e,"FileWriteStream",{get:function(){return m},set:function(F){m=F},enumerable:!0,configurable:!0});function g(F,T){return this instanceof g?(p.apply(this,arguments),this):g.apply(Object.create(g.prototype),arguments)}function C(){var F=this;ge(F.path,F.flags,F.mode,function(T,_){T?(F.autoClose&&F.destroy(),F.emit("error",T)):(F.fd=_,F.emit("open",_),F.read())})}function O(F,T){return this instanceof O?(h.apply(this,arguments),this):O.apply(Object.create(O.prototype),arguments)}function $(){var F=this;ge(F.path,F.flags,F.mode,function(T,_){T?(F.destroy(),F.emit("error",T)):(F.fd=_,F.emit("open",_))})}function w(F,T){return new e.ReadStream(F,T)}function ee(F,T){return new e.WriteStream(F,T)}var ae=e.open;e.open=ge;function ge(F,T,_,D){return typeof _=="function"&&(D=_,_=null),R(F,T,_,D);function R(L,y,E,v,N){return ae(L,y,E,function(x,fe){x&&(x.code==="EMFILE"||x.code==="ENFILE")?Me([R,[L,y,E,v],x,N||Date.now(),Date.now()]):typeof v=="function"&&v.apply(this,arguments)})}}return e}function Me(e){we("ENQUEUE",e[0].name,e[1]),I[B].push(e),Jt()}var ft;function vr(){for(var e=Date.now(),t=0;t<I[B].length;++t)I[B][t].length>2&&(I[B][t][3]=e,I[B][t][4]=e);Jt()}function Jt(){if(clearTimeout(ft),ft=void 0,I[B].length!==0){var e=I[B].shift(),t=e[0],n=e[1],r=e[2],i=e[3],o=e[4];if(i===void 0)we("RETRY",t.name,n),t.apply(null,n);else if(Date.now()-i>=6e4){we("TIMEOUT",t.name,n);var s=n.pop();typeof s=="function"&&s.call(null,r)}else{var a=Date.now()-o,u=Math.max(o-i,1),d=Math.min(u*1.2,100);a>=d?(we("RETRY",t.name,n),t.apply(null,n.concat([i]))):I[B].push(e)}ft===void 0&&(ft=setTimeout(Jt,0))}}(function(e){const t=J.fromCallback,n=j,r=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","lchmod","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(i=>typeof n[i]=="function");Object.keys(n).forEach(i=>{i!=="promises"&&(e[i]=n[i])}),r.forEach(i=>{e[i]=t(n[i])}),e.exists=function(i,o){return typeof o=="function"?n.exists(i,o):new Promise(s=>n.exists(i,s))},e.read=function(i,o,s,a,u,d){return typeof d=="function"?n.read(i,o,s,a,u,d):new Promise((c,f)=>{n.read(i,o,s,a,u,(l,p,h)=>{if(l)return f(l);c({bytesRead:p,buffer:h})})})},e.write=function(i,o,...s){return typeof s[s.length-1]=="function"?n.write(i,o,...s):new Promise((a,u)=>{n.write(i,o,...s,(d,c,f)=>{if(d)return u(d);a({bytesWritten:c,buffer:f})})})},typeof n.realpath.native=="function"&&(e.realpath.native=t(n.realpath.native))})(Ut);const Gt=M;function Sr(e){return e=Gt.normalize(Gt.resolve(e)).split(Gt.sep),e.length>0?e[0]:null}const Ss=/[<>:"|?*]/;function ws(e){const t=Sr(e);return e=e.replace(t,""),Ss.test(e)}var wr={getRootPath:Sr,invalidWin32Path:ws};const Es=j,qt=M,$s=wr.invalidWin32Path,Fs=parseInt("0777",8);function Ht(e,t,n,r){if(typeof t=="function"?(n=t,t={}):(!t||typeof t!="object")&&(t={mode:t}),process.platform==="win32"&&$s(e)){const s=new Error(e+" contains invalid WIN32 path characters.");return s.code="EINVAL",n(s)}let i=t.mode;const o=t.fs||Es;i===void 0&&(i=Fs&~process.umask()),r||(r=null),n=n||function(){},e=qt.resolve(e),o.mkdir(e,i,s=>{if(!s)return r=r||e,n(null,r);switch(s.code){case"ENOENT":if(qt.dirname(e)===e)return n(s);Ht(qt.dirname(e),t,(a,u)=>{a?n(a,u):Ht(e,t,n,u)});break;default:o.stat(e,(a,u)=>{a||!u.isDirectory()?n(s,r):n(null,r)});break}})}var Cs=Ht;const Os=j,Vt=M,xs=wr.invalidWin32Path,Ts=parseInt("0777",8);function Kt(e,t,n){(!t||typeof t!="object")&&(t={mode:t});let r=t.mode;const i=t.fs||Os;if(process.platform==="win32"&&xs(e)){const o=new Error(e+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}r===void 0&&(r=Ts&~process.umask()),n||(n=null),e=Vt.resolve(e);try{i.mkdirSync(e,r),n=n||e}catch(o){if(o.code==="ENOENT"){if(Vt.dirname(e)===e)throw o;n=Kt(Vt.dirname(e),t,n),Kt(e,t,n)}else{let s;try{s=i.statSync(e)}catch{throw o}if(!s.isDirectory())throw o}}return n}var _s=Kt;const Ns=J.fromCallback,Yt=Ns(Cs),Zt=_s;var Z={mkdirs:Yt,mkdirsSync:Zt,mkdirp:Yt,mkdirpSync:Zt,ensureDir:Yt,ensureDirSync:Zt};const z=j,Er=ve,dt=M;function bs(){let e=dt.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));e=dt.join(Er.tmpdir(),e);const t=new Date(1435410243862);z.writeFileSync(e,"https://github.com/jprichardson/node-fs-extra/pull/141");const n=z.openSync(e,"r+");return z.futimesSync(n,t,t),z.closeSync(n),z.statSync(e).mtime>1435410243e3}function Ms(e){let t=dt.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));t=dt.join(Er.tmpdir(),t);const n=new Date(1435410243862);z.writeFile(t,"https://github.com/jprichardson/node-fs-extra/pull/141",r=>{if(r)return e(r);z.open(t,"r+",(i,o)=>{if(i)return e(i);z.futimes(o,n,n,s=>{if(s)return e(s);z.close(o,a=>{if(a)return e(a);z.stat(t,(u,d)=>{if(u)return e(u);e(null,d.mtime>1435410243e3)})})})})})}function As(e){if(typeof e=="number")return Math.floor(e/1e3)*1e3;if(e instanceof Date)return new Date(Math.floor(e.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function Is(e,t,n,r){z.open(e,"r+",(i,o)=>{if(i)return r(i);z.futimes(o,t,n,s=>{z.close(o,a=>{r&&r(s||a)})})})}function Ls(e,t,n){const r=z.openSync(e,"r+");return z.futimesSync(r,t,n),z.closeSync(r)}var $r={hasMillisRes:Ms,hasMillisResSync:bs,timeRemoveMillis:As,utimesMillis:Is,utimesMillisSync:Ls};const X=j,q=M,Fr=10,Cr=5,ks=0,Xt=process.versions.node.split("."),Or=Number.parseInt(Xt[0],10),xr=Number.parseInt(Xt[1],10),js=Number.parseInt(Xt[2],10);function ze(){if(Or>Fr)return!0;if(Or===Fr){if(xr>Cr)return!0;if(xr===Cr&&js>=ks)return!0}return!1}function Ds(e,t,n){ze()?X.stat(e,{bigint:!0},(r,i)=>{if(r)return n(r);X.stat(t,{bigint:!0},(o,s)=>o?o.code==="ENOENT"?n(null,{srcStat:i,destStat:null}):n(o):n(null,{srcStat:i,destStat:s}))}):X.stat(e,(r,i)=>{if(r)return n(r);X.stat(t,(o,s)=>o?o.code==="ENOENT"?n(null,{srcStat:i,destStat:null}):n(o):n(null,{srcStat:i,destStat:s}))})}function Rs(e,t){let n,r;ze()?n=X.statSync(e,{bigint:!0}):n=X.statSync(e);try{ze()?r=X.statSync(t,{bigint:!0}):r=X.statSync(t)}catch(i){if(i.code==="ENOENT")return{srcStat:n,destStat:null};throw i}return{srcStat:n,destStat:r}}function Ps(e,t,n,r){Ds(e,t,(i,o)=>{if(i)return r(i);const{srcStat:s,destStat:a}=o;return a&&a.ino&&a.dev&&a.ino===s.ino&&a.dev===s.dev?r(new Error("Source and destination must not be the same.")):s.isDirectory()&&en(e,t)?r(new Error(Je(e,t,n))):r(null,{srcStat:s,destStat:a})})}function Ws(e,t,n){const{srcStat:r,destStat:i}=Rs(e,t);if(i&&i.ino&&i.dev&&i.ino===r.ino&&i.dev===r.dev)throw new Error("Source and destination must not be the same.");if(r.isDirectory()&&en(e,t))throw new Error(Je(e,t,n));return{srcStat:r,destStat:i}}function Qt(e,t,n,r,i){const o=q.resolve(q.dirname(e)),s=q.resolve(q.dirname(n));if(s===o||s===q.parse(s).root)return i();ze()?X.stat(s,{bigint:!0},(a,u)=>a?a.code==="ENOENT"?i():i(a):u.ino&&u.dev&&u.ino===t.ino&&u.dev===t.dev?i(new Error(Je(e,n,r))):Qt(e,t,s,r,i)):X.stat(s,(a,u)=>a?a.code==="ENOENT"?i():i(a):u.ino&&u.dev&&u.ino===t.ino&&u.dev===t.dev?i(new Error(Je(e,n,r))):Qt(e,t,s,r,i))}function Tr(e,t,n,r){const i=q.resolve(q.dirname(e)),o=q.resolve(q.dirname(n));if(o===i||o===q.parse(o).root)return;let s;try{ze()?s=X.statSync(o,{bigint:!0}):s=X.statSync(o)}catch(a){if(a.code==="ENOENT")return;throw a}if(s.ino&&s.dev&&s.ino===t.ino&&s.dev===t.dev)throw new Error(Je(e,n,r));return Tr(e,t,o,r)}function en(e,t){const n=q.resolve(e).split(q.sep).filter(i=>i),r=q.resolve(t).split(q.sep).filter(i=>i);return n.reduce((i,o,s)=>i&&r[s]===o,!0)}function Je(e,t,n){return`Cannot ${n} '${e}' to a subdirectory of itself, '${t}'.`}var pt={checkPaths:Ps,checkPathsSync:Ws,checkParentPaths:Qt,checkParentPathsSync:Tr,isSrcSubdir:en},tn,_r;function Bs(){return _r||(_r=1,tn=function(e){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(e)}catch{return new Buffer(e)}return new Buffer(e)}),tn}const A=j,Ge=M,Us=Z.mkdirsSync,zs=$r.utimesMillisSync,qe=pt;function Js(e,t,n){typeof n=="function"&&(n={filter:n}),n=n||{},n.clobber="clobber"in n?!!n.clobber:!0,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);const{srcStat:r,destStat:i}=qe.checkPathsSync(e,t,"copy");return qe.checkParentPathsSync(e,r,t,"copy"),Gs(i,e,t,n)}function Gs(e,t,n,r){if(r.filter&&!r.filter(t,n))return;const i=Ge.dirname(n);return A.existsSync(i)||Us(i),Nr(e,t,n,r)}function Nr(e,t,n,r){if(!(r.filter&&!r.filter(t,n)))return qs(e,t,n,r)}function qs(e,t,n,r){const o=(r.dereference?A.statSync:A.lstatSync)(t);if(o.isDirectory())return Ys(o,e,t,n,r);if(o.isFile()||o.isCharacterDevice()||o.isBlockDevice())return Hs(o,e,t,n,r);if(o.isSymbolicLink())return Qs(e,t,n,r)}function Hs(e,t,n,r,i){return t?Vs(e,n,r,i):br(e,n,r,i)}function Vs(e,t,n,r){if(r.overwrite)return A.unlinkSync(n),br(e,t,n,r);if(r.errorOnExist)throw new Error(`'${n}' already exists`)}function br(e,t,n,r){return typeof A.copyFileSync=="function"?(A.copyFileSync(t,n),A.chmodSync(n,e.mode),r.preserveTimestamps?zs(n,e.atime,e.mtime):void 0):Ks(e,t,n,r)}function Ks(e,t,n,r){const o=Bs()(65536),s=A.openSync(t,"r"),a=A.openSync(n,"w",e.mode);let u=0;for(;u<e.size;){const d=A.readSync(s,o,0,65536,u);A.writeSync(a,o,0,d),u+=d}r.preserveTimestamps&&A.futimesSync(a,e.atime,e.mtime),A.closeSync(s),A.closeSync(a)}function Ys(e,t,n,r,i){if(!t)return Zs(e,n,r,i);if(t&&!t.isDirectory())throw new Error(`Cannot overwrite non-directory '${r}' with directory '${n}'.`);return Mr(n,r,i)}function Zs(e,t,n,r){return A.mkdirSync(n),Mr(t,n,r),A.chmodSync(n,e.mode)}function Mr(e,t,n){A.readdirSync(e).forEach(r=>Xs(r,e,t,n))}function Xs(e,t,n,r){const i=Ge.join(t,e),o=Ge.join(n,e),{destStat:s}=qe.checkPathsSync(i,o,"copy");return Nr(s,i,o,r)}function Qs(e,t,n,r){let i=A.readlinkSync(t);if(r.dereference&&(i=Ge.resolve(process.cwd(),i)),e){let o;try{o=A.readlinkSync(n)}catch(s){if(s.code==="EINVAL"||s.code==="UNKNOWN")return A.symlinkSync(i,n);throw s}if(r.dereference&&(o=Ge.resolve(process.cwd(),o)),qe.isSrcSubdir(i,o))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${o}'.`);if(A.statSync(n).isDirectory()&&qe.isSrcSubdir(o,i))throw new Error(`Cannot overwrite '${o}' with '${i}'.`);return ea(i,n)}else return A.symlinkSync(i,n)}function ea(e,t){return A.unlinkSync(t),A.symlinkSync(e,t)}var ta=Js,Ar={copySync:ta};const na=J.fromPromise,Ir=Ut;function ra(e){return Ir.access(e).then(()=>!0).catch(()=>!1)}var ce={pathExists:na(ra),pathExistsSync:Ir.existsSync};const U=j,He=M,ia=Z.mkdirs,oa=ce.pathExists,sa=$r.utimesMillis,Ve=pt;function aa(e,t,n,r){typeof n=="function"&&!r?(r=n,n={}):typeof n=="function"&&(n={filter:n}),r=r||function(){},n=n||{},n.clobber="clobber"in n?!!n.clobber:!0,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`),Ve.checkPaths(e,t,"copy",(i,o)=>{if(i)return r(i);const{srcStat:s,destStat:a}=o;Ve.checkParentPaths(e,s,t,"copy",u=>u?r(u):n.filter?kr(Lr,a,e,t,n,r):Lr(a,e,t,n,r))})}function Lr(e,t,n,r,i){const o=He.dirname(n);oa(o,(s,a)=>{if(s)return i(s);if(a)return nn(e,t,n,r,i);ia(o,u=>u?i(u):nn(e,t,n,r,i))})}function kr(e,t,n,r,i,o){Promise.resolve(i.filter(n,r)).then(s=>s?e(t,n,r,i,o):o(),s=>o(s))}function nn(e,t,n,r,i){return r.filter?kr(jr,e,t,n,r,i):jr(e,t,n,r,i)}function jr(e,t,n,r,i){(r.dereference?U.stat:U.lstat)(t,(s,a)=>{if(s)return i(s);if(a.isDirectory())return fa(a,e,t,n,r,i);if(a.isFile()||a.isCharacterDevice()||a.isBlockDevice())return ca(a,e,t,n,r,i);if(a.isSymbolicLink())return ma(e,t,n,r,i)})}function ca(e,t,n,r,i,o){return t?ua(e,n,r,i,o):Dr(e,n,r,i,o)}function ua(e,t,n,r,i){if(r.overwrite)U.unlink(n,o=>o?i(o):Dr(e,t,n,r,i));else return r.errorOnExist?i(new Error(`'${n}' already exists`)):i()}function Dr(e,t,n,r,i){return typeof U.copyFile=="function"?U.copyFile(t,n,o=>o?i(o):Rr(e,n,r,i)):la(e,t,n,r,i)}function la(e,t,n,r,i){const o=U.createReadStream(t);o.on("error",s=>i(s)).once("open",()=>{const s=U.createWriteStream(n,{mode:e.mode});s.on("error",a=>i(a)).on("open",()=>o.pipe(s)).once("close",()=>Rr(e,n,r,i))})}function Rr(e,t,n,r){U.chmod(t,e.mode,i=>i?r(i):n.preserveTimestamps?sa(t,e.atime,e.mtime,r):r())}function fa(e,t,n,r,i,o){return t?t&&!t.isDirectory()?o(new Error(`Cannot overwrite non-directory '${r}' with directory '${n}'.`)):Pr(n,r,i,o):da(e,n,r,i,o)}function da(e,t,n,r,i){U.mkdir(n,o=>{if(o)return i(o);Pr(t,n,r,s=>s?i(s):U.chmod(n,e.mode,i))})}function Pr(e,t,n,r){U.readdir(e,(i,o)=>i?r(i):Wr(o,e,t,n,r))}function Wr(e,t,n,r,i){const o=e.pop();return o?pa(e,o,t,n,r,i):i()}function pa(e,t,n,r,i,o){const s=He.join(n,t),a=He.join(r,t);Ve.checkPaths(s,a,"copy",(u,d)=>{if(u)return o(u);const{destStat:c}=d;nn(c,s,a,i,f=>f?o(f):Wr(e,n,r,i,o))})}function ma(e,t,n,r,i){U.readlink(t,(o,s)=>{if(o)return i(o);if(r.dereference&&(s=He.resolve(process.cwd(),s)),e)U.readlink(n,(a,u)=>a?a.code==="EINVAL"||a.code==="UNKNOWN"?U.symlink(s,n,i):i(a):(r.dereference&&(u=He.resolve(process.cwd(),u)),Ve.isSrcSubdir(s,u)?i(new Error(`Cannot copy '${s}' to a subdirectory of itself, '${u}'.`)):e.isDirectory()&&Ve.isSrcSubdir(u,s)?i(new Error(`Cannot overwrite '${u}' with '${s}'.`)):ha(s,n,i)));else return U.symlink(s,n,i)})}function ha(e,t,n){U.unlink(t,r=>r?n(r):U.symlink(e,t,n))}var ya=aa;const ga=J.fromCallback;var Br={copy:ga(ya)};const Ur=j,zr=M,b=yn,Ke=process.platform==="win32";function Jr(e){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(n=>{e[n]=e[n]||Ur[n],n=n+"Sync",e[n]=e[n]||Ur[n]}),e.maxBusyTries=e.maxBusyTries||3}function rn(e,t,n){let r=0;typeof t=="function"&&(n=t,t={}),b(e,"rimraf: missing path"),b.strictEqual(typeof e,"string","rimraf: path should be a string"),b.strictEqual(typeof n,"function","rimraf: callback function required"),b(t,"rimraf: invalid options argument provided"),b.strictEqual(typeof t,"object","rimraf: options should be object"),Jr(t),Gr(e,t,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&r<t.maxBusyTries){r++;const s=r*100;return setTimeout(()=>Gr(e,t,i),s)}o.code==="ENOENT"&&(o=null)}n(o)})}function Gr(e,t,n){b(e),b(t),b(typeof n=="function"),t.lstat(e,(r,i)=>{if(r&&r.code==="ENOENT")return n(null);if(r&&r.code==="EPERM"&&Ke)return qr(e,t,r,n);if(i&&i.isDirectory())return mt(e,t,r,n);t.unlink(e,o=>{if(o){if(o.code==="ENOENT")return n(null);if(o.code==="EPERM")return Ke?qr(e,t,o,n):mt(e,t,o,n);if(o.code==="EISDIR")return mt(e,t,o,n)}return n(o)})})}function qr(e,t,n,r){b(e),b(t),b(typeof r=="function"),n&&b(n instanceof Error),t.chmod(e,438,i=>{i?r(i.code==="ENOENT"?null:n):t.stat(e,(o,s)=>{o?r(o.code==="ENOENT"?null:n):s.isDirectory()?mt(e,t,n,r):t.unlink(e,r)})})}function Hr(e,t,n){let r;b(e),b(t),n&&b(n instanceof Error);try{t.chmodSync(e,438)}catch(i){if(i.code==="ENOENT")return;throw n}try{r=t.statSync(e)}catch(i){if(i.code==="ENOENT")return;throw n}r.isDirectory()?ht(e,t,n):t.unlinkSync(e)}function mt(e,t,n,r){b(e),b(t),n&&b(n instanceof Error),b(typeof r=="function"),t.rmdir(e,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?va(e,t,r):i&&i.code==="ENOTDIR"?r(n):r(i)})}function va(e,t,n){b(e),b(t),b(typeof n=="function"),t.readdir(e,(r,i)=>{if(r)return n(r);let o=i.length,s;if(o===0)return t.rmdir(e,n);i.forEach(a=>{rn(zr.join(e,a),t,u=>{if(!s){if(u)return n(s=u);--o===0&&t.rmdir(e,n)}})})})}function Vr(e,t){let n;t=t||{},Jr(t),b(e,"rimraf: missing path"),b.strictEqual(typeof e,"string","rimraf: path should be a string"),b(t,"rimraf: missing options"),b.strictEqual(typeof t,"object","rimraf: options should be object");try{n=t.lstatSync(e)}catch(r){if(r.code==="ENOENT")return;r.code==="EPERM"&&Ke&&Hr(e,t,r)}try{n&&n.isDirectory()?ht(e,t,null):t.unlinkSync(e)}catch(r){if(r.code==="ENOENT")return;if(r.code==="EPERM")return Ke?Hr(e,t,r):ht(e,t,r);if(r.code!=="EISDIR")throw r;ht(e,t,r)}}function ht(e,t,n){b(e),b(t),n&&b(n instanceof Error);try{t.rmdirSync(e)}catch(r){if(r.code==="ENOTDIR")throw n;if(r.code==="ENOTEMPTY"||r.code==="EEXIST"||r.code==="EPERM")Sa(e,t);else if(r.code!=="ENOENT")throw r}}function Sa(e,t){if(b(e),b(t),t.readdirSync(e).forEach(n=>Vr(zr.join(e,n),t)),Ke){const n=Date.now();do try{return t.rmdirSync(e,t)}catch{}while(Date.now()-n<500)}else return t.rmdirSync(e,t)}var wa=rn;rn.sync=Vr;const Ea=J.fromCallback,Kr=wa;var yt={remove:Ea(Kr),removeSync:Kr.sync};const $a=J.fromCallback,Yr=j,Zr=M,Xr=Z,Qr=yt,ei=$a(function(t,n){n=n||function(){},Yr.readdir(t,(r,i)=>{if(r)return Xr.mkdirs(t,n);i=i.map(s=>Zr.join(t,s)),o();function o(){const s=i.pop();if(!s)return n();Qr.remove(s,a=>{if(a)return n(a);o()})}})});function ti(e){let t;try{t=Yr.readdirSync(e)}catch{return Xr.mkdirsSync(e)}t.forEach(n=>{n=Zr.join(e,n),Qr.removeSync(n)})}var Fa={emptyDirSync:ti,emptydirSync:ti,emptyDir:ei,emptydir:ei};const Ca=J.fromCallback,ni=M,Ye=j,ri=Z,Oa=ce.pathExists;function xa(e,t){function n(){Ye.writeFile(e,"",r=>{if(r)return t(r);t()})}Ye.stat(e,(r,i)=>{if(!r&&i.isFile())return t();const o=ni.dirname(e);Oa(o,(s,a)=>{if(s)return t(s);if(a)return n();ri.mkdirs(o,u=>{if(u)return t(u);n()})})})}function Ta(e){let t;try{t=Ye.statSync(e)}catch{}if(t&&t.isFile())return;const n=ni.dirname(e);Ye.existsSync(n)||ri.mkdirsSync(n),Ye.writeFileSync(e,"")}var _a={createFile:Ca(xa),createFileSync:Ta};const Na=J.fromCallback,ii=M,Ee=j,oi=Z,si=ce.pathExists;function ba(e,t,n){function r(i,o){Ee.link(i,o,s=>{if(s)return n(s);n(null)})}si(t,(i,o)=>{if(i)return n(i);if(o)return n(null);Ee.lstat(e,s=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),n(s);const a=ii.dirname(t);si(a,(u,d)=>{if(u)return n(u);if(d)return r(e,t);oi.mkdirs(a,c=>{if(c)return n(c);r(e,t)})})})})}function Ma(e,t){if(Ee.existsSync(t))return;try{Ee.lstatSync(e)}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}const r=ii.dirname(t);return Ee.existsSync(r)||oi.mkdirsSync(r),Ee.linkSync(e,t)}var Aa={createLink:Na(ba),createLinkSync:Ma};const me=M,Ze=j,Ia=ce.pathExists;function La(e,t,n){if(me.isAbsolute(e))return Ze.lstat(e,r=>r?(r.message=r.message.replace("lstat","ensureSymlink"),n(r)):n(null,{toCwd:e,toDst:e}));{const r=me.dirname(t),i=me.join(r,e);return Ia(i,(o,s)=>o?n(o):s?n(null,{toCwd:i,toDst:e}):Ze.lstat(e,a=>a?(a.message=a.message.replace("lstat","ensureSymlink"),n(a)):n(null,{toCwd:e,toDst:me.relative(r,e)})))}}function ka(e,t){let n;if(me.isAbsolute(e)){if(n=Ze.existsSync(e),!n)throw new Error("absolute srcpath does not exist");return{toCwd:e,toDst:e}}else{const r=me.dirname(t),i=me.join(r,e);if(n=Ze.existsSync(i),n)return{toCwd:i,toDst:e};if(n=Ze.existsSync(e),!n)throw new Error("relative srcpath does not exist");return{toCwd:e,toDst:me.relative(r,e)}}}var ja={symlinkPaths:La,symlinkPathsSync:ka};const ai=j;function Da(e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,t)return n(null,t);ai.lstat(e,(r,i)=>{if(r)return n(null,"file");t=i&&i.isDirectory()?"dir":"file",n(null,t)})}function Ra(e,t){let n;if(t)return t;try{n=ai.lstatSync(e)}catch{return"file"}return n&&n.isDirectory()?"dir":"file"}var Pa={symlinkType:Da,symlinkTypeSync:Ra};const Wa=J.fromCallback,ci=M,Ae=j,ui=Z,Ba=ui.mkdirs,Ua=ui.mkdirsSync,li=ja,za=li.symlinkPaths,Ja=li.symlinkPathsSync,fi=Pa,Ga=fi.symlinkType,qa=fi.symlinkTypeSync,di=ce.pathExists;function Ha(e,t,n,r){r=typeof n=="function"?n:r,n=typeof n=="function"?!1:n,di(t,(i,o)=>{if(i)return r(i);if(o)return r(null);za(e,t,(s,a)=>{if(s)return r(s);e=a.toDst,Ga(a.toCwd,n,(u,d)=>{if(u)return r(u);const c=ci.dirname(t);di(c,(f,l)=>{if(f)return r(f);if(l)return Ae.symlink(e,t,d,r);Ba(c,p=>{if(p)return r(p);Ae.symlink(e,t,d,r)})})})})})}function Va(e,t,n){if(Ae.existsSync(t))return;const i=Ja(e,t);e=i.toDst,n=qa(i.toCwd,n);const o=ci.dirname(t);return Ae.existsSync(o)||Ua(o),Ae.symlinkSync(e,t,n)}var Ka={createSymlink:Wa(Ha),createSymlinkSync:Va};const gt=_a,vt=Aa,St=Ka;var Ya={createFile:gt.createFile,createFileSync:gt.createFileSync,ensureFile:gt.createFile,ensureFileSync:gt.createFileSync,createLink:vt.createLink,createLinkSync:vt.createLinkSync,ensureLink:vt.createLink,ensureLinkSync:vt.createLinkSync,createSymlink:St.createSymlink,createSymlinkSync:St.createSymlinkSync,ensureSymlink:St.createSymlink,ensureSymlinkSync:St.createSymlinkSync},Ie;try{Ie=j}catch{Ie=Oe}function Za(e,t,n){n==null&&(n=t,t={}),typeof t=="string"&&(t={encoding:t}),t=t||{};var r=t.fs||Ie,i=!0;"throws"in t&&(i=t.throws),r.readFile(e,t,function(o,s){if(o)return n(o);s=mi(s);var a;try{a=JSON.parse(s,t?t.reviver:null)}catch(u){return i?(u.message=e+": "+u.message,n(u)):n(null,null)}n(null,a)})}function Xa(e,t){t=t||{},typeof t=="string"&&(t={encoding:t});var n=t.fs||Ie,r=!0;"throws"in t&&(r=t.throws);try{var i=n.readFileSync(e,t);return i=mi(i),JSON.parse(i,t.reviver)}catch(o){if(r)throw o.message=e+": "+o.message,o;return null}}function pi(e,t){var n,r=`
`;typeof t=="object"&&t!==null&&(t.spaces&&(n=t.spaces),t.EOL&&(r=t.EOL));var i=JSON.stringify(e,t?t.replacer:null,n);return i.replace(/\n/g,r)+r}function Qa(e,t,n,r){r==null&&(r=n,n={}),n=n||{};var i=n.fs||Ie,o="";try{o=pi(t,n)}catch(s){r&&r(s,null);return}i.writeFile(e,o,n,r)}function ec(e,t,n){n=n||{};var r=n.fs||Ie,i=pi(t,n);return r.writeFileSync(e,i,n)}function mi(e){return Buffer.isBuffer(e)&&(e=e.toString("utf8")),e=e.replace(/^\uFEFF/,""),e}var tc={readFile:Za,readFileSync:Xa,writeFile:Qa,writeFileSync:ec},nc=tc;const hi=J.fromCallback,wt=nc;var on={readJson:hi(wt.readFile),readJsonSync:wt.readFileSync,writeJson:hi(wt.writeFile),writeJsonSync:wt.writeFileSync};const rc=M,ic=Z,oc=ce.pathExists,yi=on;function sc(e,t,n,r){typeof n=="function"&&(r=n,n={});const i=rc.dirname(e);oc(i,(o,s)=>{if(o)return r(o);if(s)return yi.writeJson(e,t,n,r);ic.mkdirs(i,a=>{if(a)return r(a);yi.writeJson(e,t,n,r)})})}var ac=sc;const cc=j,uc=M,lc=Z,fc=on;function dc(e,t,n){const r=uc.dirname(e);cc.existsSync(r)||lc.mkdirsSync(r),fc.writeJsonSync(e,t,n)}var pc=dc;const mc=J.fromCallback,G=on;G.outputJson=mc(ac),G.outputJsonSync=pc,G.outputJSON=G.outputJson,G.outputJSONSync=G.outputJsonSync,G.writeJSON=G.writeJson,G.writeJSONSync=G.writeJsonSync,G.readJSON=G.readJson,G.readJSONSync=G.readJsonSync;var hc=G;const gi=j,yc=M,gc=Ar.copySync,vi=yt.removeSync,vc=Z.mkdirpSync,Si=pt;function Sc(e,t,n){n=n||{};const r=n.overwrite||n.clobber||!1,{srcStat:i}=Si.checkPathsSync(e,t,"move");return Si.checkParentPathsSync(e,i,t,"move"),vc(yc.dirname(t)),wc(e,t,r)}function wc(e,t,n){if(n)return vi(t),wi(e,t,n);if(gi.existsSync(t))throw new Error("dest already exists.");return wi(e,t,n)}function wi(e,t,n){try{gi.renameSync(e,t)}catch(r){if(r.code!=="EXDEV")throw r;return Ec(e,t,n)}}function Ec(e,t,n){return gc(e,t,{overwrite:n,errorOnExist:!0}),vi(e)}var $c=Sc,Fc={moveSync:$c};const Cc=j,Oc=M,xc=Br.copy,Ei=yt.remove,Tc=Z.mkdirp,_c=ce.pathExists,$i=pt;function Nc(e,t,n,r){typeof n=="function"&&(r=n,n={});const i=n.overwrite||n.clobber||!1;$i.checkPaths(e,t,"move",(o,s)=>{if(o)return r(o);const{srcStat:a}=s;$i.checkParentPaths(e,a,t,"move",u=>{if(u)return r(u);Tc(Oc.dirname(t),d=>d?r(d):bc(e,t,i,r))})})}function bc(e,t,n,r){if(n)return Ei(t,i=>i?r(i):Fi(e,t,n,r));_c(t,(i,o)=>i?r(i):o?r(new Error("dest already exists.")):Fi(e,t,n,r))}function Fi(e,t,n,r){Cc.rename(e,t,i=>i?i.code!=="EXDEV"?r(i):Mc(e,t,n,r):r())}function Mc(e,t,n,r){xc(e,t,{overwrite:n,errorOnExist:!0},o=>o?r(o):Ei(e,r))}var Ac=Nc;const Ic=J.fromCallback;var Lc={move:Ic(Ac)};const kc=J.fromCallback,Xe=j,Ci=M,Oi=Z,jc=ce.pathExists;function Dc(e,t,n,r){typeof n=="function"&&(r=n,n="utf8");const i=Ci.dirname(e);jc(i,(o,s)=>{if(o)return r(o);if(s)return Xe.writeFile(e,t,n,r);Oi.mkdirs(i,a=>{if(a)return r(a);Xe.writeFile(e,t,n,r)})})}function Rc(e,...t){const n=Ci.dirname(e);if(Xe.existsSync(n))return Xe.writeFileSync(e,...t);Oi.mkdirsSync(n),Xe.writeFileSync(e,...t)}var Pc={outputFile:kc(Dc),outputFileSync:Rc};(function(e){e.exports=Object.assign({},Ut,Ar,Br,Fa,Ya,hc,Z,Fc,Lc,Pc,ce,yt);const t=Oe;Object.getOwnPropertyDescriptor(t,"promises")&&Object.defineProperty(e.exports,"promises",{get(){return t.promises}})})(mr);var xi=mr.exports,Wc=()=>new Date;const Bc=W("streamroller:fileNameFormatter"),Uc=M,zc=".gz",Jc=".";var Gc=({file:e,keepFileExt:t,needsIndex:n,alwaysIncludeDate:r,compress:i,fileNameSep:o})=>{let s=o||Jc;const a=Uc.join(e.dir,e.name),u=p=>p+e.ext,d=(p,h,S)=>(n||!S)&&h?p+s+h:p,c=(p,h,S)=>(h>0||r)&&S?p+s+S:p,f=(p,h)=>h&&i?p+zc:p,l=t?[c,d,u,f]:[u,c,d,f];return({date:p,index:h})=>(Bc(`_formatFileName: date=${p}, index=${h}`),l.reduce((S,m)=>m(S,h,p),a))};const $e=W("streamroller:fileNameParser"),Ti=".gz",_i=kt,qc=".";var Hc=({file:e,keepFileExt:t,pattern:n,fileNameSep:r})=>{let i=r||qc;const o=(l,p)=>l.endsWith(Ti)?($e("it is gzipped"),p.isCompressed=!0,l.slice(0,-1*Ti.length)):l,s="__NOT_MATCHING__";let f=[o,t?l=>l.startsWith(e.name)&&l.endsWith(e.ext)?($e("it starts and ends with the right things"),l.slice(e.name.length+1,-1*e.ext.length)):s:l=>l.startsWith(e.base)?($e("it starts with the right things"),l.slice(e.base.length+1)):s,n?(l,p)=>{const h=l.split(i);let S=h[h.length-1];$e("items: ",h,", indexStr: ",S);let m=l;S!==void 0&&S.match(/^\d+$/)?(m=l.slice(0,-1*(S.length+1)),$e(`dateStr is ${m}`),n&&!m&&(m=S,S="0")):S="0";try{const g=_i.parse(n,m,new Date(0,0));return _i.asString(n,g)!==m?l:(p.index=parseInt(S,10),p.date=m,p.timestamp=g.getTime(),"")}catch(g){return $e(`Problem parsing ${m} as ${n}, error was: `,g),l}}:(l,p)=>l.match(/^\d+$/)?($e("it has an index"),p.index=parseInt(l,10),""):l];return l=>{let p={filename:l,index:0,isCompressed:!1};return f.reduce((S,m)=>m(S,p),l)?null:p}};const H=W("streamroller:moveAndMaybeCompressFile"),ue=xi,Vc=yo,Kc=function(e){const t={mode:parseInt("0600",8),compress:!1},n=Object.assign({},t,e);return H(`_parseOption: moveAndMaybeCompressFile called with option=${JSON.stringify(n)}`),n},Yc=async(e,t,n)=>{if(n=Kc(n),e===t){H("moveAndMaybeCompressFile: source and target are the same, not doing anything");return}if(await ue.pathExists(e))if(H(`moveAndMaybeCompressFile: moving file from ${e} to ${t} ${n.compress?"with":"without"} compress`),n.compress)await new Promise((r,i)=>{let o=!1;const s=ue.createWriteStream(t,{mode:n.mode,flags:"wx"}).on("open",()=>{o=!0;const a=ue.createReadStream(e).on("open",()=>{a.pipe(Vc.createGzip()).pipe(s)}).on("error",u=>{H(`moveAndMaybeCompressFile: error reading ${e}`,u),s.destroy(u)})}).on("finish",()=>{H(`moveAndMaybeCompressFile: finished compressing ${t}, deleting ${e}`),ue.unlink(e).then(r).catch(a=>{H(`moveAndMaybeCompressFile: error deleting ${e}, truncating instead`,a),ue.truncate(e).then(r).catch(u=>{H(`moveAndMaybeCompressFile: error truncating ${e}`,u),i(u)})})}).on("error",a=>{o?(H(`moveAndMaybeCompressFile: error writing ${t}, deleting`,a),ue.unlink(t).then(()=>{i(a)}).catch(u=>{H(`moveAndMaybeCompressFile: error deleting ${t}`,u),i(u)})):(H(`moveAndMaybeCompressFile: error creating ${t}`,a),i(a))})}).catch(()=>{});else{H(`moveAndMaybeCompressFile: renaming ${e} to ${t}`);try{await ue.move(e,t,{overwrite:!0})}catch(r){if(H(`moveAndMaybeCompressFile: error renaming ${e} to ${t}`,r),r.code!=="ENOENT"){H("moveAndMaybeCompressFile: trying copy+truncate instead");try{await ue.copy(e,t,{overwrite:!0}),await ue.truncate(e)}catch(i){H("moveAndMaybeCompressFile: error copy+truncate",i)}}}}};var Zc=Yc;const V=W("streamroller:RollingFileWriteStream"),Fe=xi,Ce=M,Xc=ve,Et=Wc,$t=kt,{Writable:Qc}=hn,eu=Gc,tu=Hc,nu=Zc,ru=e=>(V(`deleteFiles: files to delete: ${e}`),Promise.all(e.map(t=>Fe.unlink(t).catch(n=>{V(`deleteFiles: error when unlinking ${t}, ignoring. Error was ${n}`)}))));let iu=class extends Qc{constructor(t,n){if(V(`constructor: creating RollingFileWriteStream. path=${t}`),typeof t!="string"||t.length===0)throw new Error(`Invalid filename: ${t}`);if(t.endsWith(Ce.sep))throw new Error(`Filename is a directory: ${t}`);t.indexOf(`~${Ce.sep}`)===0&&(t=t.replace("~",Xc.homedir())),super(n),this.options=this._parseOption(n),this.fileObject=Ce.parse(t),this.fileObject.dir===""&&(this.fileObject=Ce.parse(Ce.join(process.cwd(),t))),this.fileFormatter=eu({file:this.fileObject,alwaysIncludeDate:this.options.alwaysIncludePattern,needsIndex:this.options.maxSize<Number.MAX_SAFE_INTEGER,compress:this.options.compress,keepFileExt:this.options.keepFileExt,fileNameSep:this.options.fileNameSep}),this.fileNameParser=tu({file:this.fileObject,keepFileExt:this.options.keepFileExt,pattern:this.options.pattern,fileNameSep:this.options.fileNameSep}),this.state={currentSize:0},this.options.pattern&&(this.state.currentDate=$t(this.options.pattern,Et())),this.filename=this.fileFormatter({index:0,date:this.state.currentDate}),["a","a+","as","as+"].includes(this.options.flags)&&this._setExistingSizeAndDate(),V(`constructor: create new file ${this.filename}, state=${JSON.stringify(this.state)}`),this._renewWriteStream()}_setExistingSizeAndDate(){try{const t=Fe.statSync(this.filename);this.state.currentSize=t.size,this.options.pattern&&(this.state.currentDate=$t(this.options.pattern,t.mtime))}catch{return}}_parseOption(t){const n={maxSize:0,numToKeep:Number.MAX_SAFE_INTEGER,encoding:"utf8",mode:parseInt("0600",8),flags:"a",compress:!1,keepFileExt:!1,alwaysIncludePattern:!1},r=Object.assign({},n,t);if(!r.maxSize)delete r.maxSize;else if(r.maxSize<=0)throw new Error(`options.maxSize (${r.maxSize}) should be > 0`);if(r.numBackups||r.numBackups===0){if(r.numBackups<0)throw new Error(`options.numBackups (${r.numBackups}) should be >= 0`);if(r.numBackups>=Number.MAX_SAFE_INTEGER)throw new Error(`options.numBackups (${r.numBackups}) should be < Number.MAX_SAFE_INTEGER`);r.numToKeep=r.numBackups+1}else if(r.numToKeep<=0)throw new Error(`options.numToKeep (${r.numToKeep}) should be > 0`);return V(`_parseOption: creating stream with option=${JSON.stringify(r)}`),r}_final(t){this.currentFileStream.end("",this.options.encoding,t)}_write(t,n,r){this._shouldRoll().then(()=>{V(`_write: writing chunk. file=${this.currentFileStream.path} state=${JSON.stringify(this.state)} chunk=${t}`),this.currentFileStream.write(t,n,i=>{this.state.currentSize+=t.length,r(i)})})}async _shouldRoll(){(this._dateChanged()||this._tooBig())&&(V(`_shouldRoll: rolling because dateChanged? ${this._dateChanged()} or tooBig? ${this._tooBig()}`),await this._roll())}_dateChanged(){return this.state.currentDate&&this.state.currentDate!==$t(this.options.pattern,Et())}_tooBig(){return this.state.currentSize>=this.options.maxSize}_roll(){return V("_roll: closing the current stream"),new Promise((t,n)=>{this.currentFileStream.end("",this.options.encoding,()=>{this._moveOldFiles().then(t).catch(n)})})}async _moveOldFiles(){const t=await this._getExistingFiles(),n=this.state.currentDate?t.filter(r=>r.date===this.state.currentDate):t;for(let r=n.length;r>=0;r--){V(`_moveOldFiles: i = ${r}`);const i=this.fileFormatter({date:this.state.currentDate,index:r}),o=this.fileFormatter({date:this.state.currentDate,index:r+1}),s={compress:this.options.compress&&r===0,mode:this.options.mode};await nu(i,o,s)}this.state.currentSize=0,this.state.currentDate=this.state.currentDate?$t(this.options.pattern,Et()):null,V(`_moveOldFiles: finished rolling files. state=${JSON.stringify(this.state)}`),this._renewWriteStream(),await new Promise((r,i)=>{this.currentFileStream.write("","utf8",()=>{this._clean().then(r).catch(i)})})}async _getExistingFiles(){const t=await Fe.readdir(this.fileObject.dir).catch(()=>[]);V(`_getExistingFiles: files=${t}`);const n=t.map(i=>this.fileNameParser(i)).filter(i=>i),r=i=>(i.timestamp?i.timestamp:Et().getTime())-i.index;return n.sort((i,o)=>r(i)-r(o)),n}_renewWriteStream(){const t=this.fileFormatter({date:this.state.currentDate,index:0}),n=o=>{try{return Fe.mkdirSync(o,{recursive:!0})}catch(s){if(s.code==="ENOENT")return n(Ce.dirname(o)),n(o);if(s.code!=="EEXIST"&&s.code!=="EROFS")throw s;try{if(Fe.statSync(o).isDirectory())return o;throw s}catch{throw s}}};n(this.fileObject.dir);const r={flags:this.options.flags,encoding:this.options.encoding,mode:this.options.mode},i=function(o,s,a){return o[a]=o[s],delete o[s],o};Fe.appendFileSync(t,"",i({...r},"flags","flag")),this.currentFileStream=Fe.createWriteStream(t,r),this.currentFileStream.on("error",o=>{this.emit("error",o)})}async _clean(){const t=await this._getExistingFiles();if(V(`_clean: numToKeep = ${this.options.numToKeep}, existingFiles = ${t.length}`),V("_clean: existing files are: ",t),this._tooManyFiles(t.length)){const n=t.slice(0,t.length-this.options.numToKeep).map(r=>Ce.format({dir:this.fileObject.dir,base:r.filename}));await ru(n)}}_tooManyFiles(t){return this.options.numToKeep>0&&t>this.options.numToKeep}};var sn=iu;const ou=sn;class su extends ou{constructor(t,n,r,i){i||(i={}),n&&(i.maxSize=n),!i.numBackups&&i.numBackups!==0&&(!r&&r!==0&&(r=1),i.numBackups=r),super(t,i),this.backups=i.numBackups,this.size=this.options.maxSize}get theStream(){return this.currentFileStream}}var au=su;const cu=sn;class uu extends cu{constructor(t,n,r){n&&typeof n=="object"&&(r=n,n=null),r||(r={}),n||(n="yyyy-MM-dd"),r.pattern=n,!r.numBackups&&r.numBackups!==0?(!r.daysToKeep&&r.daysToKeep!==0?r.daysToKeep=1:process.emitWarning("options.daysToKeep is deprecated due to the confusion it causes when used together with file size rolling. Please use options.numBackups instead.","DeprecationWarning","streamroller-DEP0001"),r.numBackups=r.daysToKeep):r.daysToKeep=r.numBackups,super(t,r),this.mode=this.options.mode}get theStream(){return this.currentFileStream}}var lu=uu,Ni={RollingFileWriteStream:sn,RollingFileStream:au,DateRollingFileStream:lu};const bi=W("log4js:file"),an=M,fu=Ni,Mi=ve,du=Mi.EOL;let Ft=!1;const Ct=new Set;function Ai(){Ct.forEach(e=>{e.sighupHandler()})}function pu(e,t,n,r,i,o){if(typeof e!="string"||e.length===0)throw new Error(`Invalid filename: ${e}`);if(e.endsWith(an.sep))throw new Error(`Filename is a directory: ${e}`);e=e.replace(new RegExp(`^~(?=${an.sep}.+)`),Mi.homedir()),e=an.normalize(e),r=!r&&r!==0?5:r,bi("Creating file appender (",e,", ",n,", ",r,", ",i,", ",o,")");function s(d,c,f,l){const p=new fu.RollingFileStream(d,c,f,l);return p.on("error",h=>{console.error("log4js.fileAppender - Writing to file %s, error happened ",d,h)}),p.on("drain",()=>{process.emit("log4js:pause",!1)}),p}let a=s(e,n,r,i);const u=function(d){if(a.writable){if(i.removeColor===!0){const c=/\x1b[[0-9;]*m/g;d.data=d.data.map(f=>typeof f=="string"?f.replace(c,""):f)}a.write(t(d,o)+du,"utf8")||process.emit("log4js:pause",!0)}};return u.reopen=function(){a.end(()=>{a=s(e,n,r,i)})},u.sighupHandler=function(){bi("SIGHUP handler called."),u.reopen()},u.shutdown=function(d){Ct.delete(u),Ct.size===0&&Ft&&(process.removeListener("SIGHUP",Ai),Ft=!1),a.end("","utf-8",d)},Ct.add(u),Ft||(process.on("SIGHUP",Ai),Ft=!0),u}function mu(e,t){let n=t.basicLayout;return e.layout&&(n=t.layout(e.layout.type,e.layout)),e.mode=e.mode||384,pu(e.filename,n,e.maxLogSize,e.backups,e,e.timezoneOffset)}pr.configure=mu;var Ii={};const hu=Ni,yu=ve,gu=yu.EOL;function vu(e,t,n){const r=new hu.DateRollingFileStream(e,t,n);return r.on("error",i=>{console.error("log4js.dateFileAppender - Writing to file %s, error happened ",e,i)}),r.on("drain",()=>{process.emit("log4js:pause",!1)}),r}function Su(e,t,n,r,i){r.maxSize=r.maxLogSize;const o=vu(e,t,r),s=function(a){o.writable&&(o.write(n(a,i)+gu,"utf8")||process.emit("log4js:pause",!0))};return s.shutdown=function(a){o.end("","utf-8",a)},s}function wu(e,t){let n=t.basicLayout;return e.layout&&(n=t.layout(e.layout.type,e.layout)),e.alwaysIncludePattern||(e.alwaysIncludePattern=!1),e.mode=e.mode||384,Su(e.filename,e.pattern,n,e,e.timezoneOffset)}Ii.configure=wu;var Li={};const le=W("log4js:fileSync"),re=M,ie=Oe,ki=ve,Eu=ki.EOL;function ji(e,t){const n=r=>{try{return ie.mkdirSync(r,{recursive:!0})}catch(i){if(i.code==="ENOENT")return n(re.dirname(r)),n(r);if(i.code!=="EEXIST"&&i.code!=="EROFS")throw i;try{if(ie.statSync(r).isDirectory())return r;throw i}catch{throw i}}};n(re.dirname(e)),ie.appendFileSync(e,"",{mode:t.mode,flag:t.flags})}class $u{constructor(t,n,r,i){if(le("In RollingFileStream"),n<0)throw new Error(`maxLogSize (${n}) should be > 0`);this.filename=t,this.size=n,this.backups=r,this.options=i,this.currentSize=0;function o(s){let a=0;try{a=ie.statSync(s).size}catch{ji(s,i)}return a}this.currentSize=o(this.filename)}shouldRoll(){return le("should roll with current size %d, and max size %d",this.currentSize,this.size),this.currentSize>=this.size}roll(t){const n=this,r=new RegExp(`^${re.basename(t)}`);function i(d){return r.test(d)}function o(d){return parseInt(d.slice(`${re.basename(t)}.`.length),10)||0}function s(d,c){return o(d)-o(c)}function a(d){const c=o(d);if(le(`Index of ${d} is ${c}`),n.backups===0)ie.truncateSync(t,0);else if(c<n.backups){try{ie.unlinkSync(`${t}.${c+1}`)}catch{}le(`Renaming ${d} -> ${t}.${c+1}`),ie.renameSync(re.join(re.dirname(t),d),`${t}.${c+1}`)}}function u(){le("Renaming the old files"),ie.readdirSync(re.dirname(t)).filter(i).sort(s).reverse().forEach(a)}le("Rolling, rolling, rolling"),u()}write(t,n){const r=this;function i(){le("writing the chunk to the file"),r.currentSize+=t.length,ie.appendFileSync(r.filename,t)}le("in write"),this.shouldRoll()&&(this.currentSize=0,this.roll(this.filename)),i()}}function Fu(e,t,n,r,i,o){if(typeof e!="string"||e.length===0)throw new Error(`Invalid filename: ${e}`);if(e.endsWith(re.sep))throw new Error(`Filename is a directory: ${e}`);e=e.replace(new RegExp(`^~(?=${re.sep}.+)`),ki.homedir()),e=re.normalize(e),r=!r&&r!==0?5:r,le("Creating fileSync appender (",e,", ",n,", ",r,", ",i,", ",o,")");function s(u,d,c){let f;return d?f=new $u(u,d,c,i):f=(l=>(ji(l,i),{write(p){ie.appendFileSync(l,p)}}))(u),f}const a=s(e,n,r);return u=>{a.write(t(u,o)+Eu)}}function Cu(e,t){let n=t.basicLayout;e.layout&&(n=t.layout(e.layout.type,e.layout));const r={flags:e.flags||"a",encoding:e.encoding||"utf8",mode:e.mode||384};return Fu(e.filename,n,e.maxLogSize,e.backups,r,e.timezoneOffset)}Li.configure=Cu;var Di={};const oe=W("log4js:tcp"),Ou=go;function xu(e,t){let n=!1;const r=[];let i,o=3,s="__LOG4JS__";function a(f){oe("Writing log event to socket"),n=i.write(`${t(f)}${s}`,"utf8")}function u(){let f;for(oe("emptying buffer");f=r.shift();)a(f)}function d(){oe(`appender creating socket to ${e.host||"localhost"}:${e.port||5e3}`),s=`${e.endMsg||"__LOG4JS__"}`,i=Ou.createConnection(e.port||5e3,e.host||"localhost"),i.on("connect",()=>{oe("socket connected"),u(),n=!0}),i.on("drain",()=>{oe("drain event received, emptying buffer"),n=!0,u()}),i.on("timeout",i.end.bind(i)),i.on("error",f=>{oe("connection error",f),n=!1,u()}),i.on("close",d)}d();function c(f){n?a(f):(oe("buffering log event because it cannot write at the moment"),r.push(f))}return c.shutdown=function(f){oe("shutdown called"),r.length&&o?(oe("buffer has items, waiting 100ms to empty"),o-=1,setTimeout(()=>{c.shutdown(f)},100)):(i.removeAllListeners("close"),i.end(f))},c}function Tu(e,t){oe(`configure with config = ${e}`);let n=function(r){return r.serialise()};return e.layout&&(n=t.layout(e.layout.type,e.layout)),xu(e,n)}Di.configure=Tu;const cn=M,he=W("log4js:appenders"),Q=_e,Ri=Wt,_u=Ne,Nu=Wn,bu=rr,ne=new Map;ne.set("console",or),ne.set("stdout",sr),ne.set("stderr",ar),ne.set("logLevelFilter",cr),ne.set("categoryFilter",ur),ne.set("noLogFilter",fr),ne.set("file",pr),ne.set("dateFile",Ii),ne.set("fileSync",Li),ne.set("tcp",Di);const Qe=new Map,Ot=(e,t)=>{let n;try{const r=`${e}.cjs`;n=require.resolve(r),he("Loading module from ",r)}catch{n=e,he("Loading module from ",e)}try{return Io(n)}catch(r){Q.throwExceptionIf(t,r.code!=="MODULE_NOT_FOUND",`appender "${e}" could not be loaded (error was: ${r})`);return}},Mu=(e,t)=>ne.get(e)||Ot(`./${e}`,t)||Ot(e,t)||require.main&&require.main.filename&&Ot(cn.join(cn.dirname(require.main.filename),e),t)||Ot(cn.join(process.cwd(),e),t),xt=new Set,Pi=(e,t)=>{if(Qe.has(e))return Qe.get(e);if(!t.appenders[e])return!1;if(xt.has(e))throw new Error(`Dependency loop detected for appender ${e}.`);xt.add(e),he(`Creating appender ${e}`);const n=Au(e,t);return xt.delete(e),Qe.set(e,n),n},Au=(e,t)=>{const n=t.appenders[e],r=n.type.configure?n.type:Mu(n.type,t);return Q.throwExceptionIf(t,Q.not(r),`appender "${e}" is not valid (type "${n.type}" could not be found)`),r.appender&&(process.emitWarning(`Appender ${n.type} exports an appender function.`,"DeprecationWarning","log4js-node-DEP0001"),he("[log4js-node-DEP0001]",`DEPRECATION: Appender ${n.type} exports an appender function.`)),r.shutdown&&(process.emitWarning(`Appender ${n.type} exports a shutdown function.`,"DeprecationWarning","log4js-node-DEP0002"),he("[log4js-node-DEP0002]",`DEPRECATION: Appender ${n.type} exports a shutdown function.`)),he(`${e}: clustering.isMaster ? ${Ri.isMaster()}`),he(`${e}: appenderModule is ${je.inspect(r)}`),Ri.onlyOnMaster(()=>(he(`calling appenderModule.configure for ${e} / ${n.type}`),r.configure(bu.modifyConfig(n),Nu,i=>Pi(i,t),_u)),()=>{})},Wi=e=>{if(Qe.clear(),xt.clear(),!e)return;const t=[];Object.values(e.categories).forEach(n=>{t.push(...n.appenders)}),Object.keys(e.appenders).forEach(n=>{(t.includes(n)||e.appenders[n].type==="tcp-server"||e.appenders[n].type==="multiprocess")&&Pi(n,e)})},Bi=()=>{Wi()};Bi(),Q.addListener(e=>{Q.throwExceptionIf(e,Q.not(Q.anObject(e.appenders)),'must have a property "appenders" of type object.');const t=Object.keys(e.appenders);Q.throwExceptionIf(e,Q.not(t.length),"must define at least one appender."),t.forEach(n=>{Q.throwExceptionIf(e,Q.not(e.appenders[n].type),`appender "${n}" is not valid (must be an object with property "type")`)})}),Q.addListener(Wi),Dt.exports=Qe,Dt.exports.init=Bi;var Ui=Dt.exports,zi={exports:{}};(function(e){const t=W("log4js:categories"),n=_e,r=Ne,i=Ui,o=new Map;function s(m,g,C){if(g.inherit===!1)return;const O=C.lastIndexOf(".");if(O<0)return;const $=C.slice(0,O);let w=m.categories[$];w||(w={inherit:!0,appenders:[]}),s(m,w,$),!m.categories[$]&&w.appenders&&w.appenders.length&&w.level&&(m.categories[$]=w),g.appenders=g.appenders||[],g.level=g.level||w.level,w.appenders.forEach(ee=>{g.appenders.includes(ee)||g.appenders.push(ee)}),g.parent=w}function a(m){if(!m.categories)return;Object.keys(m.categories).forEach(C=>{const O=m.categories[C];s(m,O,C)})}n.addPreProcessingListener(m=>a(m)),n.addListener(m=>{n.throwExceptionIf(m,n.not(n.anObject(m.categories)),'must have a property "categories" of type object.');const g=Object.keys(m.categories);n.throwExceptionIf(m,n.not(g.length),"must define at least one category."),g.forEach(C=>{const O=m.categories[C];n.throwExceptionIf(m,[n.not(O.appenders),n.not(O.level)],`category "${C}" is not valid (must be an object with properties "appenders" and "level")`),n.throwExceptionIf(m,n.not(Array.isArray(O.appenders)),`category "${C}" is not valid (appenders must be an array of appender names)`),n.throwExceptionIf(m,n.not(O.appenders.length),`category "${C}" is not valid (appenders must contain at least one appender name)`),Object.prototype.hasOwnProperty.call(O,"enableCallStack")&&n.throwExceptionIf(m,typeof O.enableCallStack!="boolean",`category "${C}" is not valid (enableCallStack must be boolean type)`),O.appenders.forEach($=>{n.throwExceptionIf(m,n.not(i.get($)),`category "${C}" is not valid (appender "${$}" is not defined)`)}),n.throwExceptionIf(m,n.not(r.getLevel(O.level)),`category "${C}" is not valid (level "${O.level}" not recognised; valid levels are ${r.levels.join(", ")})`)}),n.throwExceptionIf(m,n.not(m.categories.default),'must define a "default" category.')});const u=m=>{if(o.clear(),!m)return;Object.keys(m.categories).forEach(C=>{const O=m.categories[C],$=[];O.appenders.forEach(w=>{$.push(i.get(w)),t(`Creating category ${C}`),o.set(C,{appenders:$,level:r.getLevel(O.level),enableCallStack:O.enableCallStack||!1})})})},d=()=>{u()};d(),n.addListener(u);const c=m=>{if(t(`configForCategory: searching for config for ${m}`),o.has(m))return t(`configForCategory: ${m} exists in config, returning it`),o.get(m);let g;return m.indexOf(".")>0?(t(`configForCategory: ${m} has hierarchy, cloning from parents`),g={...c(m.slice(0,m.lastIndexOf(".")))}):(o.has("default")||u({categories:{default:{appenders:["out"],level:"OFF"}}}),t("configForCategory: cloning default category"),g={...o.get("default")}),o.set(m,g),g},f=m=>c(m).appenders,l=m=>c(m).level,p=(m,g)=>{c(m).level=g},h=m=>c(m).enableCallStack===!0,S=(m,g)=>{c(m).enableCallStack=g};e.exports=o,e.exports=Object.assign(e.exports,{appendersForCategory:f,getLevelForCategory:l,setLevelForCategory:p,getEnableCallStackForCategory:h,setEnableCallStackForCategory:S,init:d})})(zi);var Ji=zi.exports;const Gi=W("log4js:logger"),Iu=er,se=Ne,Lu=Wt,Tt=Ji,qi=_e,ku=/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/,un=1,Hi=3;function Vi(e,t=Hi+un){try{const n=e.stack.split(`
`).slice(t);if(!n.length)return null;const r=ku.exec(n[0]);if(r&&r.length===6){let i="",o="",s="";return r[1]&&r[1]!==""&&([o,s]=r[1].replace(/[[\]]/g,"").split(" as "),s=s||"",o.includes(".")&&([i,o]=o.split("."))),{fileName:r[2],lineNumber:parseInt(r[3],10),columnNumber:parseInt(r[4],10),callStack:n.join(`
`),className:i,functionName:o,functionAlias:s,callerName:r[1]||""}}else console.error("log4js.logger - defaultParseCallStack error")}catch(n){console.error("log4js.logger - defaultParseCallStack error",n)}return null}let ln=class{constructor(t){if(!t)throw new Error("No category provided.");this.category=t,this.context={},this.callStackSkipIndex=0,this.parseCallStack=Vi,Gi(`Logger created (${this.category}, ${this.level})`)}get level(){return se.getLevel(Tt.getLevelForCategory(this.category),se.OFF)}set level(t){Tt.setLevelForCategory(this.category,se.getLevel(t,this.level))}get useCallStack(){return Tt.getEnableCallStackForCategory(this.category)}set useCallStack(t){Tt.setEnableCallStackForCategory(this.category,t===!0)}get callStackLinesToSkip(){return this.callStackSkipIndex}set callStackLinesToSkip(t){if(typeof t!="number")throw new TypeError("Must be a number");if(t<0)throw new RangeError("Must be >= 0");this.callStackSkipIndex=t}log(t,...n){const r=se.getLevel(t);r?this.isLevelEnabled(r)&&this._log(r,n):qi.validIdentifier(t)&&n.length>0?(this.log(se.WARN,"log4js:logger.log: valid log-level not found as first parameter given:",t),this.log(se.INFO,`[${t}]`,...n)):this.log(se.INFO,t,...n)}isLevelEnabled(t){return this.level.isLessThanOrEqualTo(t)}_log(t,n){Gi(`sending log data (${t}) to appenders`);const r=n.find(s=>s instanceof Error);let i;if(this.useCallStack){try{r&&(i=this.parseCallStack(r,this.callStackSkipIndex+un))}catch{}i=i||this.parseCallStack(new Error,this.callStackSkipIndex+Hi+un)}const o=new Iu(this.category,t,n,this.context,i,r);Lu.send(o)}addContext(t,n){this.context[t]=n}removeContext(t){delete this.context[t]}clearContext(){this.context={}}setParseCallStackFunction(t){if(typeof t=="function")this.parseCallStack=t;else if(typeof t>"u")this.parseCallStack=Vi;else throw new TypeError("Invalid type passed to setParseCallStackFunction")}};function Ki(e){const t=se.getLevel(e),r=t.toString().toLowerCase().replace(/_([a-z])/g,o=>o[1].toUpperCase()),i=r[0].toUpperCase()+r.slice(1);ln.prototype[`is${i}Enabled`]=function(){return this.isLevelEnabled(t)},ln.prototype[r]=function(...o){this.log(t,...o)}}se.levels.forEach(Ki),qi.addListener(()=>{se.levels.forEach(Ki)});var ju=ln;const Le=Ne,Du=':remote-addr - - ":method :url HTTP/:http-version" :status :content-length ":referrer" ":user-agent"';function Ru(e){return e.originalUrl||e.url}function Pu(e,t,n){const r=o=>{const s=o.concat();for(let a=0;a<s.length;++a)for(let u=a+1;u<s.length;++u)s[a].token==s[u].token&&s.splice(u--,1);return s},i=[];return i.push({token:":url",replacement:Ru(e)}),i.push({token:":protocol",replacement:e.protocol}),i.push({token:":hostname",replacement:e.hostname}),i.push({token:":method",replacement:e.method}),i.push({token:":status",replacement:t.__statusCode||t.statusCode}),i.push({token:":response-time",replacement:t.responseTime}),i.push({token:":date",replacement:new Date().toUTCString()}),i.push({token:":referrer",replacement:e.headers.referer||e.headers.referrer||""}),i.push({token:":http-version",replacement:`${e.httpVersionMajor}.${e.httpVersionMinor}`}),i.push({token:":remote-addr",replacement:e.headers["x-forwarded-for"]||e.ip||e._remoteAddress||e.socket&&(e.socket.remoteAddress||e.socket.socket&&e.socket.socket.remoteAddress)}),i.push({token:":user-agent",replacement:e.headers["user-agent"]}),i.push({token:":content-length",replacement:t.getHeader("content-length")||t.__headers&&t.__headers["Content-Length"]||"-"}),i.push({token:/:req\[([^\]]+)]/g,replacement(o,s){return e.headers[s.toLowerCase()]}}),i.push({token:/:res\[([^\]]+)]/g,replacement(o,s){return t.getHeader(s.toLowerCase())||t.__headers&&t.__headers[s]}}),r(n.concat(i))}function Yi(e,t){for(let n=0;n<t.length;n++)e=e.replace(t[n].token,t[n].replacement);return e}function Wu(e){let t=null;if(e instanceof RegExp&&(t=e),typeof e=="string"&&(t=new RegExp(e)),Array.isArray(e)){const n=e.map(r=>r.source?r.source:r);t=new RegExp(n.join("|"))}return t}function Bu(e,t,n){let r=t;if(n){const i=n.find(o=>{let s=!1;return o.from&&o.to?s=e>=o.from&&e<=o.to:s=o.codes.indexOf(e)!==-1,s});i&&(r=Le.getLevel(i.level,r))}return r}var Uu=function(t,n){typeof n=="string"||typeof n=="function"?n={format:n}:n=n||{};const r=t;let i=Le.getLevel(n.level,Le.INFO);const o=n.format||Du;return(s,a,u)=>{if(typeof s._logging<"u")return u();if(typeof n.nolog!="function"){const d=Wu(n.nolog);if(d&&d.test(s.originalUrl))return u()}if(r.isLevelEnabled(i)||n.level==="auto"){const d=new Date,{writeHead:c}=a;s._logging=!0,a.writeHead=(p,h)=>{a.writeHead=c,a.writeHead(p,h),a.__statusCode=p,a.__headers=h||{}};let f=!1;const l=()=>{if(f)return;if(f=!0,typeof n.nolog=="function"&&n.nolog(s,a)===!0){s._logging=!1;return}a.responseTime=new Date-d,a.statusCode&&n.level==="auto"&&(i=Le.INFO,a.statusCode>=300&&(i=Le.WARN),a.statusCode>=400&&(i=Le.ERROR)),i=Bu(a.statusCode,i,n.statusRules);const p=Pu(s,a,n.tokens||[]);if(n.context&&r.addContext("res",a),typeof o=="function"){const h=o(s,a,S=>Yi(S,p));h&&r.log(i,h)}else r.log(i,Yi(o,p));n.context&&r.removeContext("res")};a.on("end",l),a.on("finish",l),a.on("error",l),a.on("close",l)}return u()}};const Zi=W("log4js:recording"),_t=[];function zu(){return function(e){Zi(`received logEvent, number of events now ${_t.length+1}`),Zi("log event was ",e),_t.push(e)}}function Xi(){return _t.slice()}function Qi(){_t.length=0}var Ju={configure:zu,replay:Xi,playback:Xi,reset:Qi,erase:Qi};const ye=W("log4js:main"),Gu=Oe,qu=Fo({proto:!0}),Hu=_e,Vu=Wn,Ku=Ne,eo=Ui,to=Ji,Yu=ju,Zu=Wt,Xu=Uu,Qu=Ju;let et=!1;function el(e){if(!et)return;ye("Received log event ",e),to.appendersForCategory(e.categoryName).forEach(n=>{n(e)})}function tl(e){ye(`Loading configuration from ${e}`);try{return JSON.parse(Gu.readFileSync(e,"utf8"))}catch(t){throw new Error(`Problem reading config from file "${e}". Error was ${t.message}`,t)}}function no(e){et&&ro();let t=e;return typeof t=="string"&&(t=tl(e)),ye(`Configuration is ${t}`),Hu.configure(qu(t)),Zu.onMessage(el),et=!0,io}function nl(){return Qu}function ro(e=()=>{}){if(typeof e!="function")throw new TypeError("Invalid callback passed to shutdown");ye("Shutdown called. Disabling all log writing."),et=!1;const t=Array.from(eo.values());eo.init(),to.init();const n=t.reduce((s,a)=>a.shutdown?s+1:s,0);n===0&&(ye("No appenders with shutdown functions found."),e());let r=0,i;ye(`Found ${n} appenders with shutdown functions.`);function o(s){i=i||s,r+=1,ye(`Appender shutdowns complete: ${r} / ${n}`),r>=n&&(ye("All shutdown functions completed."),e(i))}t.filter(s=>s.shutdown).forEach(s=>s.shutdown(o))}function rl(e){return et||no(process.env.LOG4JS_CONFIG||{appenders:{out:{type:"stdout"}},categories:{default:{appenders:["out"],level:"OFF"}}}),new Yu(e||"default")}const io={getLogger:rl,configure:no,shutdown:ro,connectLogger:Xu,levels:Ku,addLayout:Vu.addLayout,recording:nl};var fn=io,oo=(e=>(e.ERROR="ERROR",e.WARN="WARN",e.INFO="INFO",e.DEBUG="DEBUG",e.TRACE="TRACE",e))(oo||{});let so=class{static configure(t,n){fn.configure({appenders:{file:{type:"fileSync",filename:`${t}`,maxLogSize:5*1024*1024,backups:5,compress:!0,encoding:"utf-8",layout:{type:"pattern",pattern:"[%d] [%p] [%z] [ArkAnalyzer] - %m"}},console:{type:"console",layout:{type:"pattern",pattern:"[%d] [%p] [%z] [ArkAnalyzer] - %m"}}},categories:{default:{appenders:["console"],level:"info",enableCallStack:!1},codelinter:{appenders:["file"],level:n,enableCallStack:!0}}})}static getLogger(){return fn.getLogger("codelinter")}static setLogLevel(t){fn.getLogger("codelinter").level=t}};const ke=so.getLogger();var il=(e=>(e[e.ETS=0]="ETS",e[e.TS=1]="TS",e))(il||{});const ao={ignores:[".git",".preview",".hvigor",".idea","test","ohosTest"],include:/(?<!\.d)\.(ets|ts|json5)$/};class co{constructor(){this.statistics=[[0,0],[0,0]]}async init(t,n,r,i){this.tsModule=await require(te.join(t,"node_modules/typescript")),this.processUIModule=await require(te.join(t,"lib/process_ui_syntax")),this.preProcessModule=await require(te.join(t,"lib/pre_process.js")),this.compilerOptions=this.tsModule.readConfigFile(te.resolve(t,"tsconfig.json"),this.tsModule.sys.readFile).config.compilerOptions,this.compilerOptions.target="ESNext",this.compilerOptions.sourceMap=!1;let o=await require(te.join(t,"main"));this.projectConfig=o.projectConfig,this.projectConfig.projectPath=te.resolve(n),this.projectConfig.saveTsPath=te.resolve(r,i),this.projectConfig.buildMode="release",this.projectConfig.projectRootPath="."}async compileProject(){process.env.rawFileResource="./",process.env.compileMode="moduleJson",process.env.compiler="on",ke.info("Ets2ts-getAllEts start");let t=[];this.getAllEts(this.projectConfig.projectPath,t)&&this.mkOutputPath(this.projectConfig.projectPath),ke.info("Ets2ts-getAllEts done");for(let n of t)n.endsWith(".ets")?this.compileEts(n):this.cp2output(n);ke.info(`Ets2ts-compileEtsTime: ${this.statistics[0][1]/1e3}s, cnt: ${this.statistics[0][0]}, avg time: ${this.statistics[0][1]/this.statistics[0][0]}ms`),ke.info(`Ets2ts-copyTsTime: ${this.statistics[1][1]/1e3}s, cnt: ${this.statistics[1][0]}, avg time: ${this.statistics[1][1]/this.statistics[1][0]}ms`)}emitWarning(t){}emitError(t){}compileEts(t){let n=new Date().getTime(),r=xe.readFileSync(t,"utf8");this.resourcePath=t,this.preProcessModule(r),this.tsModule.transpileModule(r,{compilerOptions:this.compilerOptions,fileName:`${t}`,transformers:{before:[this.processUIModule.processUISyntax(null,!1),this.getDumpSourceTransformer(this)]}}),r=void 0;let i=new Date().getTime();this.statistics[0][0]++,this.statistics[0][1]+=i-n}mkOutputPath(t){let n=this.getOutputPath(t);xe.mkdirSync(n,{recursive:!0})}getOutputPath(t){let n=te.relative(this.projectConfig.projectPath,t);return te.join(this.projectConfig.saveTsPath,n)}cp2output(t){let n=new Date().getTime(),r=this.getOutputPath(t);xe.cpSync(t,r);let i=new Date().getTime();this.statistics[1][0]++,this.statistics[1][1]+=i-n}getAllEts(t,n=[]){let r=!1;return xe.readdirSync(t,{withFileTypes:!0}).forEach(i=>{const o=te.resolve(t,i.name);i.isDirectory()&&!ao.ignores.includes(i.name)?this.getAllEts(o,n)&&(r=!0,this.mkOutputPath(o)):te.basename(o).match(ao.include)&&(n.push(o),r=!0)}),r}getDumpSourceTransformer(t){return n=>{function r(i){const o=t.tsModule.createPrinter({newLine:t.tsModule.NewLineKind.LineFeed}),s={sourceMap:!0},a={sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,sourceRoot:"",mapRoot:"",extendedDiagnostics:!1},u=t.tsModule.createCompilerHost(s),d=i.fileName,c=t.tsModule.createSourceMapGenerator(u,t.tsModule.getBaseFileName(d),"","",a),f=t.tsModule.createTextWriter(t.tsModule.getNewLineCharacter({newLine:t.tsModule.NewLineKind.LineFeed,removeComments:!1}));return o.writeFile(i,f,c),{content:f.getText(),sourceMapJson:c.toJSON()}}return i=>{let o=r(i),s=t.getOutputPath(i.fileName);return s.endsWith(".ets")&&(s=s.replace(/\.ets$/,".ts")),xe.writeFileSync(s,o.content),xe.writeFileSync(s+".map",JSON.stringify(o.sourceMapJson)),i.statements=[],i.text="",i.original=void 0,i}}}}async function uo(e,t,n,r){let i=new co;await i.init(e,t,n,r),await i.compileProject()}(async function(){so.configure(process.argv[6],oo.TRACE),ke.info("start ets2ts ",process.argv);const e=new Date().getTime();uo(process.argv[2],process.argv[3],process.argv[4],process.argv[5]);const t=new Date().getTime();ke.info(`ets2ts took: ${(t-e)/1e3}s`)})(),exports.Ets2ts=co,exports.runEts2Ts=uo;
